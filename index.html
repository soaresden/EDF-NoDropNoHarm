<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Falling Object Impact Simulator</title>
  <style>
    :root{
      --ground-h: 80px;
      --sea-h: 70px;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    html{overflow-x:hidden}
    body{
      font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background:linear-gradient(135deg,#00A8E9 0%,#000E47 100%);
      min-height:100vh;padding:10px;overflow-x:hidden;width:100%;max-width:100vw;
    }

    /* Mobile nav */
    .mobile-nav{
      position:fixed;top:0;left:0;right:0;
      background:linear-gradient(135deg,#00A8E9 0%,#000E47 100%);
      padding:10px;z-index:1000;box-shadow:0 2px 10px rgba(0,0,0,.3);display:none;
    }
    .header-logos-mobile{display:flex;justify-content:space-between;align-items:center;padding:5px 10px;margin-bottom:5px}
    .header-logo-mobile{max-height:50px;max-width:120px;object-fit:contain}
    .nav-title{color:#fff;text-align:center;font-size:1.1em;font-weight:bold;margin-bottom:10px}
    .nav-buttons{display:flex;gap:5px;overflow-x:auto;padding:5px;-webkit-overflow-scrolling:touch;scrollbar-width:none}
    .nav-buttons::-webkit-scrollbar{display:none}
    .nav-btn{flex:0 0 auto;background:rgba(255,255,255,.2);border:2px solid rgba(255,255,255,.3);color:#fff;
      padding:8px 15px;border-radius:20px;font-size:.85em;font-weight:bold;cursor:pointer;transition:.3s;white-space:nowrap}
    .nav-btn.active{background:#fff;color:#00A8E9;border-color:#fff}

    .container{max-width:1800px;margin:0 auto;background:#fff;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.3);overflow:hidden;width:100%}
    .header{
      background:linear-gradient(135deg,#00A8E9 0%,#000E47 100%);
      color:#fff;padding:30px 30px 20px;text-align:center;position:relative
    }
    .header-top{display:flex;align-items:center;justify-content:center;gap:30px;min-height:100px;margin-bottom:15px}
    .header-logo{height:80px;max-width:200px;object-fit:contain}
    .header-content{flex:1;max-width:600px}
    .header h1{font-size:2em;margin-bottom:8px}
    .header p{font-size:1em;opacity:.95}
    .header-description{font-size:.9em;opacity:.85;margin-top:10px;font-style:italic;line-height:1.5}
    .lightning-easter-egg{display:inline-block;cursor:pointer;font-size:1em;transition:.3s;animation:sparkle 2s infinite}
    .lightning-easter-egg:hover{transform:scale(1.2) rotate(15deg);filter:brightness(1.5)}
    @keyframes sparkle{0%,100%{opacity:1}50%{opacity:.7}}
    .person.electrocuted{animation:electrocute .5s ease-out}
    @keyframes electrocute{
      0%,100%{filter:brightness(1);transform:translateX(-50%) rotate(0deg)}
      10%,30%,50%,70%,90%{filter:brightness(5) contrast(2);transform:translateX(-50%) rotate(-5deg)}
      20%,40%,60%,80%{filter:brightness(5) contrast(2);transform:translateX(-50%) rotate(5deg)}
    }

    .main-grid{display:grid;grid-template-columns:1fr;gap:20px;padding:20px}
    .top-section{display:grid;grid-template-columns:320px 1fr;gap:20px}
    .left-column{display:flex;flex-direction:column;gap:15px}
    .controls{display:flex;flex-direction:column;gap:15px}
    .control-group{background:#f8f9fa;padding:15px;border-radius:15px;border:2px solid #e9ecef}
    .control-group label{display:block;font-weight:600;margin-bottom:10px;color:#495057;font-size:.95em}
    .collapsible-header{display:flex;align-items:center;justify-content:space-between;cursor:pointer;font-weight:600;color:#495057;font-size:.95em}
    .collapsible-arrow{transition:.3s;display:inline-block}
    .collapsible-header.collapsed .collapsible-arrow{transform:rotate(-90deg)}
    .collapsible-content{max-height:500px;overflow:hidden;transition:max-height .3s ease}
    .collapsible-content.collapsed{max-height:0;overflow:hidden}
    .slider-container{display:flex;align-items:center;gap:10px}
    input[type=range]{flex:1;height:8px;border-radius:5px;background:#dee2e6;outline:none;-webkit-appearance:none}
    input[type=range]::-webkit-slider-thumb{
      -webkit-appearance:none;appearance:none;width:20px;height:20px;border-radius:50%;
      background:#00A8E9;cursor:pointer;border:3px solid #fff;box-shadow:0 2px 5px rgba(0,0,0,.2)
    }
    input[type=range]::-moz-range-thumb{width:20px;height:20px;border-radius:50%;background:#00A8E9;cursor:pointer;border:3px solid #fff;box-shadow:0 2px 5px rgba(0,0,0,.2)}
    .height-value{min-width:60px;text-align:right;font-weight:bold;color:#00A8E9}

    /* Custom Weight styling */
    .custom-weight-group{background:#f8f9fa;padding:15px;border-radius:15px;border:2px solid #e9ecef}
    .custom-weight-label{display:block;font-weight:600;margin-bottom:10px;color:#495057;font-size:.95em}
    .custom-weight-slider-container{display:flex;align-items:center;gap:10px}
    .custom-weight-input{flex:1;display:flex;align-items:center;gap:8px}
    #customWeightInput{flex:1;height:8px;border-radius:5px;background:#dee2e6;outline:none;-webkit-appearance:none}
    #customWeightInput::-webkit-slider-thumb{
      -webkit-appearance:none;appearance:none;width:20px;height:20px;border-radius:50%;
      background:#00A8E9;cursor:pointer;border:3px solid #fff;box-shadow:0 2px 5px rgba(0,0,0,.2)
    }
    #customWeightInput::-moz-range-thumb{width:20px;height:20px;border-radius:50%;background:#00A8E9;cursor:pointer;border:3px solid #fff;box-shadow:0 2px 5px rgba(0,0,0,.2)}
    #customWeightTextInput{
      width:70px;padding:8px 10px;border:2px solid #dee2e6;border-radius:6px;
      font-size:.95em;font-weight:bold;color:#00A8E9;text-align:center;
      transition:border-color .3s;
    }
    #customWeightTextInput:focus{
      outline:none;border-color:#00A8E9;box-shadow:0 0 8px rgba(0,168,233,.3);
    }
    .custom-weight-unit{font-weight:600;color:#6c757d;font-size:.95em}

    .preset-buttons{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
    .preset-btn{background:#fff;border:2px solid #e9ecef;padding:10px;border-radius:10px;cursor:pointer;transition:.3s;text-align:center;font-size:.9em}
    .preset-btn:hover{background:#00A8E9;color:#fff;border-color:#00A8E9;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,168,233,.3)}
    .preset-icon{font-size:1.5em;display:block;margin-bottom:5px}
    .preset-label{font-size:.85em;font-weight:600}
    .preset-weight{font-size:.75em;color:#6c757d;margin-top:3px}

    .visualization-container{background:#f8f9fa;border-radius:15px;padding:15px;border:2px solid #e9ecef;height:600px;position:relative}
    #visualization{
      position:relative;height:100%;
      background:linear-gradient(to bottom, rgba(135,206,235,.3) 0%, rgba(255,255,255,.1) 60%, rgba(101,67,33,.12) 100%);
      border-radius:10px;overflow:hidden;transition:filter .25s ease;
    }

    /* SEA band (boat floats) */
    .sea{
      position:absolute;left:0;right:0;bottom:var(--ground-h);
      height:var(--sea-h);
      background:linear-gradient(180deg, rgba(0,149,255,.9), rgba(0,96,191,.95));
      z-index:1;
    }
    /* simple wave shine */
    .sea::after{
      content:'';position:absolute;left:0;right:0;top:0;bottom:0;
      background:repeating-linear-gradient( -5deg, rgba(255,255,255,.15), rgba(255,255,255,.15) 6px, transparent 7px, transparent 16px);
      opacity:.5;animation:waves 6s linear infinite;
    }
    @keyframes waves{from{transform:translateX(0)}to{transform:translateX(-80px)}}

    .height-scale{position:absolute;right:10px;top:0;bottom:var(--ground-h);width:50px;display:flex;flex-direction:column;justify-content:space-between;pointer-events:none;z-index:2}
    .scale-mark{
      position:absolute;right:0;font-size:.85em;color:#495057;font-weight:700;padding:3px 6px;background:rgba(255,255,255,.9);
      border-radius:4px;border:2px solid #00A8E9;box-shadow:0 2px 4px rgba(0,0,0,.1)
    }
    .scale-mark::before{content:'';position:absolute;left:-20px;top:50%;transform:translateY(-50%);width:20px;height:2px;background:#00A8E9}

    /* reference dotted lines */
    .reference-height-line{position:absolute;left:0;right:0;height:2px;border-top:2px dotted rgba(0,168,233,.5);pointer-events:none;z-index:2}

    .stats-display{
      position:absolute;top:15px;left:15px;background:rgba(255,255,255,.95);
      padding:12px 15px;border-radius:10px;border:2px solid #e9ecef;box-shadow:0 4px 15px rgba(0,0,0,.1);z-index:10;font-size:.85em
    }
    .stats-display-mobile{display:none;background:rgba(255,255,255,.95);padding:10px 15px;border-radius:10px;border:2px solid #e9ecef;box-shadow:0 4px 15px rgba(0,0,0,.1);font-size:.8em;margin-bottom:10px}
    .stat-row{display:flex;justify-content:space-between;align-items:center;gap:15px;margin-bottom:5px;white-space:nowrap}
    .stat-row:last-child{margin-bottom:0}
    .stat-label{color:#6c757d;font-weight:600;display:flex;align-items:center;gap:5px}
    .stat-value{font-weight:bold}
    .stat-row.total .stat-value{color:#00A8E9}
    .stat-row.safe .stat-value{color:#28a745}
    .stat-row.lives .stat-value{color:#dc3545}
    .stat-row.injuries .stat-value{color:#fd7e14}

    .falling-object{position:absolute;font-size:2.5em;z-index:5;left:50%;transform:translateX(-50%);filter:drop-shadow(2px 2px 4px rgba(0,0,0,.3))}
    @keyframes fall{
      from{top:var(--start-height);transform:translateX(-50%) rotate(0deg)}
      to{top:calc(100% - calc(var(--ground-h) + 80px));transform:translateX(-50%) rotate(720deg)}
    }

    /* Ground (soil) */
    .ground{
      position:absolute;left:0;right:0;bottom:0;height:var(--ground-h);
      background:linear-gradient(to bottom,#8B4513 0%,#654321 100%);border-top:3px solid #5D4037;
      display:flex;align-items:flex-end;justify-content:center;padding-bottom:5px;z-index:3;overflow:visible;
    }
    .ground::before{content:'🌱 🌾 🌿';position:absolute;top:-15px;font-size:1.2em;width:100%;text-align:center;letter-spacing:30px}

    /* Graveyard in the soil (right) */
    #graveyardGround {
    position:absolute;
    right:10px;
    bottom:6px;
    display:none!important;
    flex-direction:row;
    gap:6px;
    z-index:4;
    pointer-events:none;
align-items:flex-end;
}
    .grave{font-size:1.6em;opacity:0;transform:translateY(10px) scale(.9)}
    @keyframes gravePop{to{opacity:1;transform:translateY(0) scale(1)}}


    .person{font-size:3em;z-index:6;position:absolute;bottom:calc(var(--ground-h) - 20px);left:50%;transform:translateX(-50%);filter:drop-shadow(2px 2px 4px rgba(0,0,0,.3))}
    .impact-effect{position:absolute;bottom:calc(var(--ground-h) + 40px);left:50%;transform:translateX(-50%);font-size:4em;z-index:7;opacity:0;transition:opacity .3s}
    .impact-effect.show{opacity:1;animation:impact .5s ease-out}
    @keyframes impact{0%{transform:translateX(-50%) scale(.5)}50%{transform:translateX(-50%) scale(1.3)}100%{transform:translateX(-50%) scale(1)}}

    /* Halo light effect - Full screen */
    .impact-halo{
      position:fixed;inset:0;z-index:15;opacity:0;pointer-events:none;
    }
    .impact-halo.show{animation:haloShowFullScreen 1.2s ease-out}
    @keyframes haloShowFullScreen{
      0%{opacity:0;}
      20%{opacity:0.8;}
      100%{opacity:0;}
    }
    .impact-halo.halo-slight{background:radial-gradient(circle at center, rgba(76,175,80,0.6) 0%, rgba(76,175,80,0.3) 30%, rgba(76,175,80,0) 100%);}
    .impact-halo.halo-minor{background:radial-gradient(circle at center, rgba(255,193,7,0.6) 0%, rgba(255,193,7,0.3) 30%, rgba(255,193,7,0) 100%);}
    .impact-halo.halo-major{background:radial-gradient(circle at center, rgba(253,126,20,0.6) 0%, rgba(253,126,20,0.3) 30%, rgba(253,126,20,0) 100%);}
    .impact-halo.halo-fatality{background:radial-gradient(circle at center, rgba(220,53,69,0.6) 0%, rgba(220,53,69,0.3) 30%, rgba(220,53,69,0) 100%);}

    .speech-bubble{
      position:absolute;bottom:calc(var(--ground-h) + 100px);left:50%;transform:translateX(-50%);
      background:#fff;padding:10px 15px;border-radius:15px;border:2px solid #495057;font-weight:600;font-size:.9em;max-width:200px;text-align:center;z-index:8;opacity:0;transition:opacity .3s;box-shadow:0 3px 10px rgba(0,0,0,.2)
    }
    .speech-bubble::after{content:'';position:absolute;bottom:-10px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:10px solid transparent;border-right:10px solid transparent;border-top:10px solid #fff}
    .speech-bubble.show{opacity:1;animation:bubble .3s ease-out}
    @keyframes bubble{0%{transform:translateX(-50%) scale(0)}50%{transform:translateX(-50%) scale(1.1)}100%{transform:translateX(-50%) scale(1)}}

    .reference-item{position:absolute;right:60px;display:flex;align-items:center;gap:8px;background:rgba(255,255,255,.5);padding:5px 10px;border-radius:8px;font-size:.8em;border:2px solid rgba(233,236,239,.5);z-index:4;opacity:.6;transition:.3s}
    .reference-icon{font-size:1.3em}
    .reference-label{font-weight:600;color:#495057}

    .simulate-btn{
      background:linear-gradient(135deg,#00A8E9 0%,#000E47 100%);color:#fff;border:none;padding:15px 30px;border-radius:12px;
      font-size:1.1em;font-weight:bold;cursor:pointer;transition:.3s;box-shadow:0 4px 15px rgba(0,168,233,.3)
    }
    .simulate-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,168,233,.4)}

    /* Random events (right->left) */
    .event{position:absolute;pointer-events:none;z-index:5;filter:drop-shadow(1px 1px 2px rgba(0,0,0,.2))}
    .event .emoji{font-size:2em;display:inline-block}

    /* Birds fly RIGHT->LEFT */
    .bird{display:none!important}
    @keyframes flyLeft{from{left:110%;transform:translateY(0)}to{left:-10%;transform:translateY(-10px)}}

    /* Boat sails on sea surface RIGHT->LEFT */
    .boat{display:none!important}
    @keyframes sailLeft{from{left:110%}to{left:-20%}}

    /* Mole (neutral) */
    .mole{display:none!important}
    .mole .emoji{font-size:1.8em;transform:translateY(100%)}
    @keyframes pop{0%,100%{transform:translateY(100%)}20%,80%{transform:translateY(0%)}}

    /* Ambulance RIGHT->LEFT on ground lane */
    .ambulance{left:110%;bottom:calc(var(--ground-h) - 20px);z-index:7}
    .ambulance .emoji{font-size:2.2em}
    .ambulance .siren{
      position:absolute;top:-8px;left:50%;transform:translateX(-50%);
      width:14px;height:8px;background:red;border-radius:2px;box-shadow:0 0 10px rgba(255,0,0,.9);
      animation:siren .4s infinite alternate
    }
    @keyframes siren{
      0%{background:red;box-shadow:0 0 10px rgba(255,0,0,.9)}
      100%{background:dodgerblue;box-shadow:0 0 10px rgba(30,144,255,.9)}
    }
    @keyframes driveLeft{from{left:110%}to{left:-20%}}
    @keyframes bandageFloat{
      0%{opacity:0;transform:translateX(-50%) scale(0);box-shadow:0 0 0 0 rgba(76,175,80,0.7)}
      50%{opacity:1;transform:translateX(-50%) scale(1.2);box-shadow:0 0 15px 8px rgba(76,175,80,0)}
      100%{opacity:0;transform:translateX(-50%) translateY(-30px) scale(1);box-shadow:0 0 0 0 rgba(76,175,80,0)}
    }
    @keyframes bandageFloatYellow{
      0%{opacity:0;transform:translateX(-50%) scale(0);box-shadow:0 0 0 0 rgba(255,193,7,0.7)}
      50%{opacity:1;transform:translateX(-50%) scale(1.2);box-shadow:0 0 15px 8px rgba(255,193,7,0)}
      100%{opacity:0;transform:translateX(-50%) translateY(-30px) scale(1);box-shadow:0 0 0 0 rgba(255,193,7,0)}
    }
    @keyframes bandageLeft{
      0%{opacity:0;transform:translateX(-80%) scale(0);box-shadow:0 0 0 0 rgba(255,193,7,0.7)}
      50%{opacity:1;transform:translateX(-80%) scale(1.2);box-shadow:0 0 15px 8px rgba(255,193,7,0)}
      100%{opacity:0;transform:translateX(-80%) translateY(-30px) scale(1);box-shadow:0 0 0 0 rgba(255,193,7,0)}
    }
    @keyframes bandageRight{
      0%{opacity:0;transform:translateX(-20%) scale(0);box-shadow:0 0 0 0 rgba(255,193,7,0.7)}
      50%{opacity:1;transform:translateX(-20%) scale(1.2);box-shadow:0 0 15px 8px rgba(255,193,7,0)}
      100%{opacity:0;transform:translateX(-20%) translateY(-30px) scale(1);box-shadow:0 0 0 0 rgba(255,193,7,0)}
    }
    @keyframes reaperAppear{
      0%{opacity:0;transform:translateX(-50%) scale(0) rotateZ(-45deg)}
      50%{opacity:1;transform:translateX(-50%) scale(1) rotateZ(0deg)}
      100%{opacity:1;transform:translateX(-50%) scale(1) rotateZ(0deg)}
    }

    /* FATALITY overlay */
    #fatalOverlay{
      position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
      font-weight:900;font-size:140px;color:#ff3333;text-shadow:0 4px 16px rgba(0,0,0,.8), 0 0 30px rgba(255,0,0,.4);
      letter-spacing:4px;opacity:0;transform:scale(.5);z-index:20;pointer-events:none;filter:drop-shadow(0 0 20px rgba(255,0,0,0.6))
    }
    @keyframes fatalShow{
      0%{opacity:0;transform:scale(.3)}
      30%{opacity:1;transform:scale(1.05)}
      60%{opacity:1;transform:scale(1)}
      100%{opacity:0;transform:scale(1)}
    }
    #visualization.drama{filter:grayscale(.8) blur(1px) brightness(.7)}

    /* Tables */
    .bottom-tables{display:grid;grid-template-columns:1fr 1fr;gap:20px}
    .severity-table{background:#f8f9fa;padding:15px;border-radius:15px;border:2px solid #e9ecef}
    .severity-table h3{
      color:#fff;background:linear-gradient(135deg,#fd7e14 0%,#dc3545 100%);
      font-size:1.1em;font-weight:bold;margin:-15px -15px 15px;padding:12px 15px;text-align:center;border-radius:15px 15px 0 0;box-shadow:0 2px 8px rgba(0,0,0,.1);text-transform:uppercase;letter-spacing:.5px
    }
    .severity-row{display:flex;align-items:center;gap:12px;padding:12px;margin-bottom:8px;border-radius:10px;border:3px solid transparent;background:#fff;transition:.3s;cursor:pointer}
    .severity-row:last-child{margin-bottom:0}
    .severity-row.active{transform:translateX(5px);box-shadow:0 4px 15px rgba(0,0,0,.15)}
    .severity-row.current{background:#fff;color:#495057;border-color:#fd7e14;display:flex;flex-direction:column;align-items:flex-start;gap:12px;padding:16px;border-radius:12px;border:2px solid #fd7e14;margin-bottom:12px;box-shadow:0 2px 8px rgba(0,0,0,.1)}
    .severity-row.current .severity-title-label{font-size:.9em;font-weight:bold;color:#6c757d;text-transform:uppercase;letter-spacing:.5px;width:100%}
    .severity-row.current-content{display:flex;align-items:center;gap:15px;width:100%;flex:1}
    .severity-row.current .severity-icon{font-size:2.2em}
    .severity-row.current .severity-info{flex:1}
    .severity-row.current .severity-threshold{font-size:.9em;color:#6c757d;margin-top:4px}
    .severity-row.current .severity-title{font-weight:bold}
    .severity-row.slight{border-color:#28a745}
    .severity-row.slight.active{background:linear-gradient(135deg,#28a745 0%,#20c997 100%);color:#fff}
    .severity-row.minor{border-color:#ffc107}
    .severity-row.minor.active{background:linear-gradient(135deg,#ffc107 0%,#ff9800 100%);color:#fff}
    .severity-row.major{border-color:#fd7e14}
    .severity-row.major.active{background:linear-gradient(135deg,#fd7e14 0%,#dc3545 100%);color:#fff}
    .severity-row.fatality{border-color:#dc3545}
    .severity-row.fatality.active{background:linear-gradient(135deg,#dc3545 0%,#c82333 100%);color:#fff}
    .severity-icon{font-size:2em}
    .severity-info{flex:1}
    .severity-title{font-weight:600;color:#495057}
    .severity-threshold{font-size:.85em;color:#6c757d}
    .severity-row.active .severity-title, .severity-row.active .severity-threshold{color:#fff}
    .severity-row.current .severity-threshold{opacity:.9}
    .equivalence-table{background:#f8f9fa;padding:15px;border-radius:15px;border:2px solid #e9ecef;display:flex;flex-direction:column}
    .equivalence-table h3{
      color:#fff;background:linear-gradient(135deg,#00A8E9 0%,#000E47 100%);
      font-size:1.1em;font-weight:bold;margin:-15px -15px 15px;padding:12px 15px;text-align:center;border-radius:15px 15px 0 0;box-shadow:0 2px 8px rgba(0,0,0,.1);text-transform:uppercase;letter-spacing:.5px
    }
    .equivalence-display-large{display:flex;flex-direction:column;align-items:flex-start;gap:12px;padding:16px;background:#fff;border-radius:12px;border:2px solid #00A8E9;margin-bottom:12px;box-shadow:0 2px 8px rgba(0,0,0,.1)}
    .equivalence-display-large .equivalence-title-large{font-size:.9em;font-weight:bold;color:#6c757d;text-transform:uppercase;letter-spacing:.5px;width:100%}
    .equivalence-display-large-content{display:flex;align-items:center;gap:15px;width:100%}
    .equivalence-icon-large{font-size:2.2em}
    .equivalence-text-large{flex:1;font-size:1em;line-height:1.4;color:#495057}
    .energy-display{font-size:1em;font-weight:bold;color:#00A8E9}
    #equivalenceRows{max-height:320px;overflow-y:auto;overflow-x:hidden;scrollbar-width:thin;scrollbar-color:#00A8E9 #e9ecef}
    #equivalenceRows::-webkit-scrollbar{width:8px}
    #equivalenceRows::-webkit-scrollbar-track{background:#e9ecef;border-radius:10px}
    #equivalenceRows::-webkit-scrollbar-thumb{background:#00A8E9;border-radius:10px}
    #equivalenceRows::-webkit-scrollbar-thumb:hover{background:#0088c9}
    .equivalence-row{display:flex;align-items:center;gap:12px;padding:12px;margin-bottom:8px;border-radius:10px;border:2px solid #e9ecef;background:#fff;transition:.3s}
    .equivalence-row:last-child{margin-bottom:0}
    .equivalence-row.active{border-color:#00A8E9;background:linear-gradient(135deg,#00A8E9 0%,#000E47 100%);color:#fff;transform:translateX(5px);box-shadow:0 4px 15px rgba(0,168,233,.4)}
    .equivalence-icon{font-size:1.8em}
    .equivalence-label{font-weight:600;font-size:.9em;line-height:1.3}
    .equivalence-energy{font-size:.75em;opacity:.7}
    .equivalence-row.active .equivalence-energy{opacity:.9}

    /* Responsive */
    @media (max-width:1400px){.container{max-width:100%}.top-section{grid-template-columns:280px 1fr}}
    @media (max-width:1024px){
      .top-section{grid-template-columns:1fr}
      .left-column{order:2}
      .visualization-container{order:1;height:500px}
      .bottom-tables{grid-template-columns:1fr}
    }
    @media (max-width:768px){
      body{padding:5px}
      .mobile-nav{display:block}
      .container{border-radius:15px;margin-top:140px}
      .header{padding:20px 15px}
      .header-top{flex-direction:column;gap:15px;min-height:auto}
      .header-logo{height:60px}
      .header h1{font-size:1.5em}
      .header p{font-size:.9em}
      .header-description{font-size:.85em}
      .main-grid{padding:10px;gap:20px}
      .top-section{display:grid;grid-template-columns:1fr;gap:30px}
      .left-column{width:100%;margin-top:30px}
      .visualization-container{height:240px;padding:10px;width:100%}
      .visualization-container .stats-display{display:none!important}
      .stats-display-mobile{display:block!important}
      .preset-buttons{grid-template-columns:repeat(2,1fr);gap:8px}
      .falling-object{font-size:2em}
      .person{font-size:2.5em}
      .bottom-tables{grid-template-columns:1fr;gap:15px}
      .left-column{position:relative;z-index:15}
      .controls{position:relative;z-index:15}
      input[type=range]{position:relative;z-index:16}
      
      /* Afficher que les emojis des références en mobile */
      .reference-label{display:none!important}
      
      /* Masquer les tombes en mobile */
      #graveyardGround{display:none!important}
      
      /* Masquer les oiseaux et autres événements */
      .bird{display:none!important}
      .boat{display:none!important}
      .mole{display:none!important}
    }
    @media (max-width:480px){
      .header h1{font-size:1.2em}
      .preset-buttons{grid-template-columns:1fr}
      .visualization-container{height:350px}
      .falling-object{font-size:1.5em}
      .person{font-size:2em}
      .speech-bubble{font-size:.8em;max-width:150px;padding:8px 12px}
      .integrated-indicator{flex-direction:column;text-align:center;gap:5px;padding:8px 12px}
      .indicator-energy{border-left:none;border-top:2px solid rgba(255,255,255,.5);padding-left:0;padding-top:5px;margin-left:0}
    }
  </style>
</head>
<body>
  <!-- Mobile Navigation -->
  <div class="mobile-nav">
    <div class="header-logos-mobile">
      <img src="./logo_cou.png" alt="Courseulles Logo" class="header-logo-mobile">
      <img src="./logo_drop.png" alt="Drop Logo" class="header-logo-mobile">
    </div>
    <div class="nav-title">📦 Falling Object Impact Simulator</div>
    <div class="nav-buttons">
      <button class="nav-btn active" onclick="showSection(event,'controls')">🎮 Controls</button>
      <button class="nav-btn" onclick="showSection(event,'visualization')">📊 Visualization</button>
      <button class="nav-btn" onclick="showSection(event,'severity')">⚠️ Severity Levels</button>
      <button class="nav-btn" onclick="showSection(event,'equivalence')">📈 Energy Equivalence</button>
    </div>
  </div>

  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="header-top">
        <img src="./logo_cou.png" alt="Courseulles Logo" class="header-logo">
        <div class="header-content">
          <h1>📦 Falling Object Impact Simulator</h1>
          <p>Understand the impact of dropped objects <span class="lightning-easter-egg" id="lightningEgg" title="Click for a surprise!">⚡</span></p>
          <div class="header-description">Help you to assess the potential outcomes of dropped object at your work site</div>
        </div>
        <img src="./logo_drop.png" alt="Drop Logo" class="header-logo">
      </div>
    </div>

    <!-- Main -->
    <div class="main-grid">
      <div class="top-section">
        <!-- Left: Controls -->
        <div class="left-column">
          <div class="controls">
            <div class="control-group">
              <label>📏 Drop Height</label>
              <div class="slider-container">
                <input type="range" id="heightInput" min="0.1" max="50" step="0.1" value="2">
                <span class="height-value" id="heightValue">2.0 m</span>
              </div>
            </div>

            <div class="control-group">
              <div class="collapsible-header" id="presetsHeader" onclick="togglePresets()">
                <label>⚙️ Predefined Objects</label>
                <span class="collapsible-arrow">▼</span>
              </div>
              <div class="collapsible-content" id="presetsContent">
                <div class="preset-buttons" id="presetButtons"></div>
              </div>
            </div>

            <div class="custom-weight-group">
              <label class="custom-weight-label">⭐ Custom Weight</label>
              <div class="custom-weight-slider-container">
                <input type="range" id="customWeightInput" min="0.01" max="100" step="0.01" value="1.0">
                <input type="number" id="customWeightTextInput" min="0.01" max="100" step="0.01" value="1.0" placeholder="1.0">
                <span class="custom-weight-unit">kg</span>
              </div>
            </div>

            <button class="simulate-btn" onclick="simulateFall()">🎬 Run Simulation</button>
          </div>
        </div>

        <!-- Right: Visualization -->
        <div class="visualization-container">
          <div id="visualization">
            <!-- FATALITY overlay -->
            <div id="fatalOverlay">☠️</div>

            <!-- Sea layer -->
            <div class="sea" aria-hidden="true"></div>

            <div class="height-scale" id="heightScale"></div>

            <div class="falling-object" id="fallingObject">📦</div>

            <!-- Reference heights -->
            <div class="reference-item" id="ref-car"><span class="reference-icon">🚗</span><span class="reference-label">Car (1.5m)</span></div>
            <div class="reference-item" id="ref-truck"><span class="reference-icon">🚚</span><span class="reference-label">Truck (3.5m)</span></div>
            <div class="reference-item" id="ref-building"><span class="reference-icon">🏢</span><span class="reference-label">Building (10m)</span></div>
            <div class="reference-item" id="ref-crane"><span class="reference-icon">🏗️</span><span class="reference-label">Crane (30m)</span></div>
            <div class="reference-item" id="ref-arc"><span class="reference-icon">🎡</span><span class="reference-label">Arc de Triomphe (50m)</span></div>

            <!-- Ground -->
            <div class="ground">
              <!-- Graveyard in soil -->
              <div id="graveyardGround" aria-live="polite"></div>

              <div class="person" id="person">🧍</div>
              <div class="impact-effect" id="impactEffect">💥</div>
              <div class="impact-halo" id="impactHalo"></div>
              <div class="speech-bubble" id="speechBubble">Ouch!</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Bottom tables -->
      <div class="bottom-tables">
        <div class="severity-table">
          <h3>⚠️ Severity Levels</h3>
          <div class="severity-row current" id="severity-current">
            <div class="severity-title-label">Current SECurity Level</div>
            <div class="severity-row current-content">
              <div class="severity-icon" id="currentIcon">📊</div>
              <div class="severity-info">
                <div class="severity-title" id="currentTitle">Waiting for simulation...</div>
                <div class="severity-threshold" id="currentSeverityText"></div>
              </div>
            </div>
          </div>
          <div class="severity-row slight" id="severity-slight">
            <div class="severity-icon">🤕</div><div class="severity-info"><div class="severity-title">Slight</div><div class="severity-threshold">[0 - 50 J]</div></div>
          </div>
          <div class="severity-row minor" id="severity-minor">
            <div class="severity-icon">😵</div><div class="severity-info"><div class="severity-title">Minor</div><div class="severity-threshold">[50 - 85 J]</div></div>
          </div>
          <div class="severity-row major" id="severity-major">
            <div class="severity-icon">🚑</div><div class="severity-info"><div class="severity-title">Major</div><div class="severity-threshold">[85 - 130 J]</div></div>
          </div>
          <div class="severity-row fatality" id="severity-fatality">
            <div class="severity-icon">💀</div><div class="severity-info"><div class="severity-title">Fatality</div><div class="severity-threshold">[130+ J]</div></div>
          </div>
        </div>

        <div class="equivalence-table">
          <h3>📊 Energy Equivalence</h3>
          <div id="equivalenceFeatured" class="equivalence-display-large" aria-live="polite">
            <div class="equivalence-title-large">Current Energy Equivalence</div>
          </div>
          <div id="equivalenceRows"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Physics & thresholds
    const g = 9.81;
    const THRESHOLDS = { slight: 50, minor: 85, major: 130 };

    const PRESETS = [
      { icon: '🔩', label: 'Bolt', weight: 0.05, desc: '50g' },
      { icon: '🔧', label: 'Wrench', weight: 0.5, desc: '500g' },
      { icon: '🔨', label: 'Hammer', weight: 1, desc: '1kg' },
      { icon: '📱', label: 'Phone', weight: 0.2, desc: '200g' },
      { icon: '⚙️', label: 'Heavy Tool', weight: 2, desc: '2kg' },
      { icon: '🪣', label: 'Bucket', weight: 0.3, desc: '300g' },
      { icon: '🧰', label: 'Toolbox', weight: 5, desc: '5kg' },
      { icon: '⛑️', label: 'Helmet', weight: 1.5, desc: '1.5kg' }
    ];

    const EQUIVALENCES = [
      { maxEnergy: 1, icon: '🪶', text: 'Falling feather' },
      { maxEnergy: 3, icon: '🍃', text: 'Falling leaf' },
      { maxEnergy: 5, icon: '🎈', text: 'Party balloon drop' },
      { maxEnergy: 10, icon: '🏓', text: 'Ping pong ball impact' },
      { maxEnergy: 15, icon: '🎾', text: 'Tennis ball throw' },
      { maxEnergy: 20, icon: '⚾', text: 'Baseball throw' },
      { maxEnergy: 30, icon: '🏀', text: 'Basketball impact' },
      { maxEnergy: 40, icon: '🥎', text: 'Softball hit' },
      { maxEnergy: 50, icon: '🥊', text: 'Amateur boxer punch' },
      { maxEnergy: 70, icon: '🎯', text: 'Dart board impact' },
      { maxEnergy: 100, icon: '🏗️', text: 'Small construction tool' },
      { maxEnergy: 150, icon: '🔨', text: 'Heavy hammer blow' },
      { maxEnergy: 200, icon: '🚗', text: 'Low-speed car bump' },
      { maxEnergy: 300, icon: '🏋️', text: 'Dropped weight plate' },
      { maxEnergy: 400, icon: '🛠️', text: 'Heavy machinery part' },
      { maxEnergy: 500, icon: '💥', text: 'Severe construction accident' },
      { maxEnergy: 750, icon: '⚠️', text: 'Critical injury zone' },
      { maxEnergy: 1000, icon: '🚨', text: 'Extreme danger level' },
      { maxEnergy: 1500, icon: '☠️', text: 'Fatal impact zone' },
      { maxEnergy: Infinity, icon: '💀', text: 'Catastrophic - Maximum risk' }
    ];

    const SPEECH_BUBBLES = {
      slight: ['Ouch!', 'That hurts!', 'Oops!', 'Watch out!'],
      minor: ['Ow ow!', 'That really hurts!', "I'm hurt!", 'Call for help!'],
      major: ['AAAAH!', 'Help!', "I'm injured!", 'Medical emergency!'],
      fatality: ['...', 'Fatal accident', 'Too late...', '💀']
    };

    // State
    let safetyStats = { preventedDeaths: 0, preventedInjuries: 0, safeSimulations: 0, totalSimulations: 0 };
    let currentWeight = 1, currentHeight = 2, isMobile = window.innerWidth <= 768;

    // DOM
    const heightInput = document.getElementById('heightInput');
    const heightValue = document.getElementById('heightValue');
    const customWeightInput = document.getElementById('customWeightInput');
    const fallingObject = document.getElementById('fallingObject');
    const person = document.getElementById('person');
    const impactEffect = document.getElementById('impactEffect');
    const impactHalo = document.getElementById('impactHalo');
    const speechBubble = document.getElementById('speechBubble');
    const heightScale = document.getElementById('heightScale');
    const visualization = document.getElementById('visualization');
    const fatalOverlay = document.getElementById('fatalOverlay');
    const graveyardGround = document.getElementById('graveyardGround');

    // Persistence
    function loadStats(){
      const saved = localStorage.getItem('safetyStats');
      if(saved){
        safetyStats = JSON.parse(saved);
        updateStatsDisplay();
      }
    }
    function saveStats(){ localStorage.setItem('safetyStats', JSON.stringify(safetyStats)); }

    function updateStatsDisplay(){
      const totalEl = document.getElementById('totalSimulations');
      const safeEl = document.getElementById('safeSimulations');
      const deathsEl = document.getElementById('preventedDeaths');
      const injuriesEl = document.getElementById('preventedInjuries');
      
      if(totalEl) totalEl.textContent = safetyStats.totalSimulations;
      if(safeEl) safeEl.textContent = safetyStats.safeSimulations;
      if(deathsEl) deathsEl.textContent = safetyStats.preventedDeaths;
      if(injuriesEl) injuriesEl.textContent = safetyStats.preventedInjuries;
    }

    // Presets
    function togglePresets(){
      const header = document.getElementById('presetsHeader');
      const content = document.getElementById('presetsContent');
      header.classList.toggle('collapsed');
      content.classList.toggle('collapsed');
    }
    function createPresets(){
      const container = document.getElementById('presetButtons');
      PRESETS.forEach(p=>{
        const btn = document.createElement('button');
        btn.className='preset-btn';
        btn.innerHTML = `
          <span class="preset-icon">${p.icon}</span>
          <div class="preset-label">${p.label}</div>
          <div class="preset-weight">${p.desc}</div>
        `;
        btn.onclick = ()=>{
          currentWeight = p.weight;
          fallingObject.textContent = p.icon;
          customWeightInput.value = p.weight;
          document.getElementById('customWeightTextInput').value = p.weight.toFixed(2);
          updateDisplay();
        };
        container.appendChild(btn);
      });
    }

    // Equivalences
    function createEquivalenceRows(){
      const container = document.getElementById('equivalenceRows');
      container.innerHTML='';
      EQUIVALENCES.forEach(eq=>{
        const row = document.createElement('div');
        row.className='equivalence-row';
        row.dataset.maxEnergy = eq.maxEnergy;
        row.innerHTML = `
          <div class="equivalence-icon">${eq.icon}</div>
          <div class="equivalence-info">
            <div class="equivalence-label">${eq.text}</div>
            <div class="equivalence-energy">${eq.maxEnergy===Infinity ? '1500+' : '≤ '+eq.maxEnergy} J</div>
          </div>
        `;
        container.appendChild(row);
      });
    }
    function getEquivalence(energy){
      for(const e of EQUIVALENCES) if(energy <= e.maxEnergy) return e;
      return EQUIVALENCES[EQUIVALENCES.length-1];
    }
    function updateFeaturedEquivalence(energy){
      const featured = document.getElementById('equivalenceFeatured');
      const eq = getEquivalence(energy);
      featured.innerHTML = `
        <div class="equivalence-title-large">Current Energy Equivalence</div>
        <div class="equivalence-display-large-content">
          <div class="equivalence-icon-large">${eq.icon}</div>
          <div class="equivalence-text-large"><strong>${eq.text}</strong><br><span class="energy-display">${energy.toFixed(1)} J</span></div>
        </div>
      `;
    }
    function updateEquivalenceRows(energy){
      const rows = document.querySelectorAll('.equivalence-row');
      rows.forEach(r=>r.classList.remove('active'));
      let idx=0;
      for(let i=0;i<rows.length;i++){
        const maxE = parseFloat(rows[i].dataset.maxEnergy);
        if(energy<=maxE){idx=i;break;}
      }
      if(rows[idx]){
        rows[idx].classList.add('active');
        const cont=document.getElementById('equivalenceRows');
        const active=rows[idx];
        const ch=cont.offsetHeight, top=active.offsetTop, h=active.offsetHeight;
        cont.scrollTo({top: top-(ch/2)+(h/2), behavior:'smooth'});
      }
      updateFeaturedEquivalence(energy);
    }

    // Scale & references
    function getDynamicMaxHeight(h){
      const m=h*1.3, r=Math.ceil(m/10)*10;
      return Math.max(10,r);
    }
    function updateHeightScale(){
      heightScale.innerHTML='';
      const dynamicMaxHeight = getDynamicMaxHeight(currentHeight);
      const marks=[];
      const interval = dynamicMaxHeight<=20 ? 5 : 10;
      for(let i=0;i<=dynamicMaxHeight;i+=interval) marks.push(i);
      marks.forEach(mark=>{
        if(mark<=dynamicMaxHeight){
          const div=document.createElement('div');
          div.className='scale-mark';
          div.textContent=mark+'m';
          div.style.top = (100 - (mark/dynamicMaxHeight)*100) + '%';
          heightScale.appendChild(div);
        }
      });

      const vizH = visualization.offsetHeight;
      const usableH = vizH - parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--ground-h'));
      visualization.querySelectorAll('.reference-height-line').forEach(l=>l.remove());

      const refs = [
        { id:'ref-car', height:1.5 },
        { id:'ref-truck', height:3.5 },
        { id:'ref-building', height:10 },
        { id:'ref-crane', height:30 },
        { id:'ref-arc', height:50 }
      ];
      refs.forEach(ref=>{
        const el=document.getElementById(ref.id);
        if(!el) return;
        if(ref.height<=dynamicMaxHeight){
          const pos = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--ground-h')) + (ref.height/dynamicMaxHeight)*usableH;
          el.style.position='absolute';
          el.style.bottom=pos+'px';
          el.style.right='60px';
          el.style.display='flex';

          const line=document.createElement('div');
          line.className='reference-height-line';
          line.style.bottom=pos+'px';
          visualization.appendChild(line);
        }else{
          el.style.display='none';
        }
      });
    }

    // Physics helpers
    function calculateEnergy(mass,height){return mass*g*height}
    function getDamageLevel(energy){
      if(energy < THRESHOLDS.slight) return 'slight';
      if(energy < THRESHOLDS.minor) return 'minor';
      if(energy < THRESHOLDS.major) return 'major';
      return 'fatality';
    }

    // UI update
    function updateDisplay(){
      currentWeight = parseFloat(currentWeight);
      currentHeight = parseFloat(heightInput.value);
      heightValue.textContent = currentHeight.toFixed(1) + ' m';

      const energy = calculateEnergy(currentWeight,currentHeight);
      const damageLevel = getDamageLevel(energy);
      updateEquivalenceRows(energy);
      updateCurrentSeverity(damageLevel, energy);

      const dynMax = getDynamicMaxHeight(currentHeight);
      const vizH = visualization.offsetHeight;
      const groundH = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--ground-h'));
      const usableH = vizH - groundH;
      const topPos = ((dynMax - currentHeight)/dynMax)*usableH;
      fallingObject.style.top = topPos + 'px';

      ['slight','minor','major','fatality'].forEach(level=>{
        const row=document.getElementById('severity-'+level);
        if(level===damageLevel) row.classList.add('active'); else row.classList.remove('active');
      });

      updateHeightScale();
    }

    function updateCurrentSeverity(level, energy){
      const textEl = document.getElementById('currentSeverityText');
      const titleEl = document.getElementById('currentTitle');
      const iconEl = document.getElementById('currentIcon');
      const severityNames = { slight: 'Slight', minor: 'Minor', major: 'Major', fatality: 'Fatality' };
      const severityIcons = { slight: '🤕', minor: '😵', major: '🚑', fatality: '💀' };
      
      titleEl.textContent = severityNames[level];
      textEl.textContent = `${energy.toFixed(2)} J`;
      iconEl.textContent = severityIcons[level];
    }

    // Inputs
    heightInput.addEventListener('input',()=>{currentHeight=parseFloat(heightInput.value);updateDisplay();});
    customWeightInput.addEventListener('input',()=>{
      const v=parseFloat(customWeightInput.value);
      if(v && v>0){
        currentWeight=v;
        document.getElementById('customWeightTextInput').value = v.toFixed(2);
        fallingObject.textContent='⚫';
        updateDisplay();
      }
    });
    document.getElementById('customWeightTextInput').addEventListener('input',()=>{
      const v=parseFloat(document.getElementById('customWeightTextInput').value);
      if(v && v>0 && v<=100){
        currentWeight=v;
        customWeightInput.value = v;
        fallingObject.textContent='⚫';
        updateDisplay();
      }
    });

    // Easter egg
    let clickCount=0;
    document.getElementById('lightningEgg').addEventListener('click',()=>{
      clickCount++;
      if(clickCount>=3){
        person.classList.add('electrocuted');person.textContent='⚡😵⚡';
        setTimeout(()=>{person.classList.remove('electrocuted');person.textContent='🧍';clickCount=0;},1000);
      }
    });

    // Graveyard in soil
    function addGrave(animated=true){
      const g=document.createElement('div');
      g.className='grave';
      g.textContent='⚰️';
      graveyardGround.appendChild(g);
      if(animated){ g.style.animation='gravePop 300ms ease-out forwards'; }
      else { g.style.opacity='1'; g.style.transform='translateY(0) scale(1)'; }
    }
    function renderGraveyard(){
      graveyardGround.innerHTML='';
      for(let i=0;i<(safetyStats.preventedDeaths||0);i++) addGrave(false);
    }

    // Random events every 20s
    const EVENT_INTERVAL_MS = 20000;
    function rand(min,max){return Math.random()*(max-min)+min;}

    function spawnBirds(){
      const bird=document.createElement('div');
      bird.className='event bird';
      bird.style.top = `${rand(5,30)}%`;
      bird.style.animation = `flyLeft ${rand(6,10)}s linear forwards`;
      bird.textContent = Math.random()<0.5 ? '🐦' : '🕊️';
      visualization.appendChild(bird);
      bird.addEventListener('animationend',()=>bird.remove());
      setTimeout(()=>bird.remove(),15000);
    }
    function spawnBoat(){
      const boat=document.createElement('div');
      boat.className='event boat';
      const seaH = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--sea-h'));
      const groundH = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--ground-h'));
      const surfaceBottom = groundH + (seaH - 28);
      boat.style.bottom = `${surfaceBottom}px`;
      boat.style.animation = `sailLeft ${rand(10,14)}s linear forwards`;
      boat.textContent = Math.random()<0.5 ? '⛵' : '🚤';
      visualization.appendChild(boat);
      boat.addEventListener('animationend',()=>boat.remove());
      setTimeout(()=>boat.remove(),16000);
    }
    function spawnMole(){
      const m=document.createElement('div');
      m.className='event mole';
      const vw = visualization.offsetWidth;
      const leftPct = (rand(50, vw-80)/vw)*100;
      m.style.left = `${Math.min(85,Math.max(5,leftPct))}%`;
      m.innerHTML = `<span class="emoji">🦫</span>`;
      visualization.appendChild(m);
      const emoji=m.querySelector('.emoji');
      emoji.style.animation = `pop ${rand(1.8,2.4)}s ease-out forwards`;
      setTimeout(()=>m.remove(),3000);
    }
    function spawnAmbulance(){
      const amb=document.createElement('div');
      amb.className='event ambulance';
      amb.style.animation = `driveLeft ${rand(6,8)}s linear forwards`;
      amb.innerHTML = `<span class="siren"></span><span class="emoji">🚑</span>`;
      visualization.appendChild(amb);
      amb.addEventListener('animationend',()=>amb.remove());
      setTimeout(()=>amb.remove(),12000);
    }
    function spawnBandage(count=1){
      if(count === 1){
        const bandage=document.createElement('div');
        bandage.className='event';
        bandage.style.left = '50%';
        bandage.style.bottom = 'calc(var(--ground-h) + 40px)';
        bandage.style.transform = 'translateX(-50%)';
        bandage.style.fontSize = '2em';
        bandage.textContent = '🩹';
        bandage.style.animation = 'bandageFloat 1.5s ease-out forwards';
        visualization.appendChild(bandage);
        setTimeout(()=>bandage.remove(),2000);
      }else if(count === 2){
        const bandage1=document.createElement('div');
        bandage1.className='event';
        bandage1.style.left = '50%';
        bandage1.style.bottom = 'calc(var(--ground-h) + 40px)';
        bandage1.style.fontSize = '2em';
        bandage1.textContent = '🩹';
        bandage1.style.animation = 'bandageLeft 1.5s ease-out forwards';
        visualization.appendChild(bandage1);
        
        setTimeout(()=>{
          const bandage2=document.createElement('div');
          bandage2.className='event';
          bandage2.style.left = '50%';
          bandage2.style.bottom = 'calc(var(--ground-h) + 40px)';
          bandage2.style.fontSize = '2em';
          bandage2.textContent = '🩹';
          bandage2.style.animation = 'bandageRight 1.5s ease-out forwards';
          visualization.appendChild(bandage2);
          setTimeout(()=>bandage2.remove(),2000);
        },300);
        
        setTimeout(()=>bandage1.remove(),2300);
      }
    }
    function spawnReaper(){
      const reaper=document.createElement('div');
      reaper.className='event';
      reaper.style.left = '50%';
      reaper.style.bottom = 'calc(var(--ground-h) + 60px)';
      reaper.style.transform = 'translateX(-50%)';
      reaper.style.fontSize = '2.5em';
      reaper.textContent = '⚰️';
      reaper.style.animation = 'reaperAppear 1s ease-out forwards';
      visualization.appendChild(reaper);
      setTimeout(()=>reaper.remove(),3000);
    }
    function spawnRandomEvent(){
      const r=Math.random();
      if(r<0.35) spawnBirds();
      else if(r<0.6) spawnBoat();
      else if(r<0.8) spawnMole();
      else spawnAmbulance();
    }

    // FATALITY effect
    function showFatality(){
      visualization.classList.add('drama');
      fatalOverlay.style.animation='fatalShow 1600ms ease-in-out forwards';
      setTimeout(()=>{
        visualization.classList.remove('drama');
        fatalOverlay.style.animation='none';
        fatalOverlay.style.opacity=0;
      },1700);
    }

    // Stats update + persistence
    function updateStats(damageLevel){
      safetyStats.totalSimulations++;
      if(damageLevel==='fatality'){
        safetyStats.preventedDeaths++;
      }else if(damageLevel==='major' || damageLevel==='minor'){
        safetyStats.preventedInjuries++;
      }else{
        safetyStats.safeSimulations++;
      }
      updateStatsDisplay();
      saveStats();
    }

    // Simulation
    function simulateFall(){
      if(isMobile){
        const vizCtn=document.querySelector('.visualization-container');
        if(vizCtn) vizCtn.scrollIntoView({behavior:'smooth',block:'center'});
      }
      // reset visuals
      fallingObject.style.animation='none';
      impactEffect.classList.remove('show');
      impactHalo.classList.remove('show');
      speechBubble.classList.remove('show');
      person.textContent='🧍';

      void fallingObject.offsetWidth; // reflow

      setTimeout(()=>{
        const dynMax = getDynamicMaxHeight(currentHeight);
        const vizH = visualization.offsetHeight;
        const groundH = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--ground-h'));
        const usableH = vizH - groundH;
        const startPos = ((dynMax - currentHeight)/dynMax)*usableH;

        const fallTime = Math.sqrt(2*currentHeight/g);

        fallingObject.style.setProperty('--start-height', startPos+'px');
        fallingObject.style.animation = `fall ${fallTime}s linear`;

        setTimeout(()=>{
          const energy = calculateEnergy(currentWeight,currentHeight);
          const damageLevel = getDamageLevel(energy);
          const map = { slight:'🤕', minor:'😵', major:'🚑', fatality:'💀' };

          impactEffect.classList.add('show');
          
          // Add halo with appropriate class
          impactHalo.className = 'impact-halo halo-' + damageLevel;
          impactHalo.classList.add('show');

          // Stats & consequences
          updateStats(damageLevel);

          const msgs = SPEECH_BUBBLES[damageLevel];
          speechBubble.textContent = msgs[Math.floor(Math.random()*msgs.length)];
          speechBubble.classList.add('show');
          person.textContent = map[damageLevel];

          if(damageLevel==='fatality'){
            if(!isMobile){
              addGrave(true);
              spawnReaper();
            }
            showFatality();
          }else if(damageLevel==='major'){
            spawnAmbulance();
          }else if(damageLevel==='minor'){
            spawnBandage(2);
          }else if(damageLevel==='slight'){
            spawnBandage(1);
          }

          setTimeout(()=>{
            impactEffect.classList.remove('show');
            impactHalo.classList.remove('show');
            speechBubble.classList.remove('show');
          },2500);
        }, fallTime*1000);
      },1000);
    }

    // Mobile nav
    function showSection(evt,section){
      document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
      if(evt && evt.currentTarget) evt.currentTarget.classList.add('active');
      let target;
      if(section==='controls') target=document.querySelector('.left-column');
      else if(section==='visualization') target=document.querySelector('.visualization-container');
      else if(section==='severity') target=document.querySelector('.severity-table');
      else if(section==='equivalence') target=document.querySelector('.equivalence-table');
      if(target) target.scrollIntoView({behavior:'smooth',block:'start'});
    }

    // Resize
    window.addEventListener('resize', ()=>{
      isMobile = window.innerWidth <= 768;
      updateHeightScale();
      updateDisplay();
    });

    // Init
    loadStats();
    createPresets();
    createEquivalenceRows();
    updateHeightScale();
    updateDisplay();
    renderGraveyard();

    // Events clock (every 20s) + one immediately
    if(!isMobile){
      spawnRandomEvent();
      setInterval(spawnRandomEvent, 20000);
    }

    // Post-layout sync
    setTimeout(()=>{ const e=calculateEnergy(currentWeight,currentHeight); updateEquivalenceRows(e); },100);
  </script>
</body>
</html>