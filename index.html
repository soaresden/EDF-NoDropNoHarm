<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Falling Object Impact Simulator</title>
  <style>
    :root{
      --ground-h: 80px;
      --sea-h: 70px;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    html{overflow-x:hidden}
    body{
      font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background:linear-gradient(135deg,#00A8E9 0%,#000E47 100%);
      min-height:100vh;padding:10px;overflow-x:hidden;width:100%;max-width:100vw;
    }

    /* Mobile nav */
    .mobile-nav{
      position:fixed;top:0;left:0;right:0;
      background:linear-gradient(135deg,#00A8E9 0%,#000E47 100%);
      padding:10px;z-index:1000;box-shadow:0 2px 10px rgba(0,0,0,.3);display:none;
    }
    .header-logos-mobile{display:flex;justify-content:space-between;align-items:center;padding:5px 10px;margin-bottom:5px}
    .header-logo-mobile{max-height:50px;max-width:120px;object-fit:contain}
    .nav-title{color:#fff;text-align:center;font-size:1.1em;font-weight:bold;margin-bottom:10px}
    .nav-buttons{display:flex;gap:5px;overflow-x:auto;padding:5px;-webkit-overflow-scrolling:touch;scrollbar-width:none}
    .nav-buttons::-webkit-scrollbar{display:none}
    .nav-btn{flex:0 0 auto;background:rgba(255,255,255,.2);border:2px solid rgba(255,255,255,.3);color:#fff;
      padding:8px 15px;border-radius:20px;font-size:.85em;font-weight:bold;cursor:pointer;transition:.3s;white-space:nowrap}
    .nav-btn.active{background:#fff;color:#00A8E9;border-color:#fff}

    .container{max-width:1800px;margin:0 auto;background:#fff;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.3);overflow:hidden;width:100%}
    .header{
      background:linear-gradient(135deg,#00A8E9 0%,#000E47 100%);
      color:#fff;padding:30px 30px 20px;text-align:center;position:relative
    }
    .header-top{display:flex;align-items:center;justify-content:center;gap:30px;min-height:100px;margin-bottom:15px}
    .header-logo{height:80px;max-width:200px;object-fit:contain}
    .header-content{flex:1;max-width:600px}
    .header h1{font-size:2em;margin-bottom:8px}
    .header p{font-size:1em;opacity:.95}
    .header-description{font-size:.9em;opacity:.85;margin-top:10px;font-style:italic;line-height:1.5}
    .lightning-easter-egg{display:inline-block;cursor:pointer;font-size:1em;transition:.3s;animation:sparkle 2s infinite}
    .lightning-easter-egg:hover{transform:scale(1.2) rotate(15deg);filter:brightness(1.5)}
    @keyframes sparkle{0%,100%{opacity:1}50%{opacity:.7}}
    .person.electrocuted{animation:electrocute .5s ease-out}
    @keyframes electrocute{
      0%,100%{filter:brightness(1);transform:translateX(-50%) rotate(0deg)}
      10%,30%,50%,70%,90%{filter:brightness(5) contrast(2);transform:translateX(-50%) rotate(-5deg)}
      20%,40%,60%,80%{filter:brightness(5) contrast(2);transform:translateX(-50%) rotate(5deg)}
    }

    .main-grid{display:grid;grid-template-columns:1fr;gap:20px;padding:20px}
    .top-section{display:grid;grid-template-columns:320px 1fr;gap:20px}
    .left-column{display:flex;flex-direction:column;gap:15px}
    .controls{display:flex;flex-direction:column;gap:15px}
    .control-group{background:#f8f9fa;padding:15px;border-radius:15px;border:2px solid #e9ecef}
    .control-group label{display:block;font-weight:600;margin-bottom:10px;color:#495057;font-size:.95em}
    .slider-container{display:flex;align-items:center;gap:10px}
    input[type=range]{flex:1;height:8px;border-radius:5px;background:#dee2e6;outline:none;-webkit-appearance:none}
    input[type=range]::-webkit-slider-thumb{
      -webkit-appearance:none;appearance:none;width:20px;height:20px;border-radius:50%;
      background:#00A8E9;cursor:pointer;border:3px solid #fff;box-shadow:0 2px 5px rgba(0,0,0,.2)
    }
    input[type=range]::-moz-range-thumb{width:20px;height:20px;border-radius:50%;background:#00A8E9;cursor:pointer;border:3px solid #fff;box-shadow:0 2px 5px rgba(0,0,0,.2)}
    .height-value{min-width:60px;text-align:right;font-weight:bold;color:#00A8E9}

    /* Custom Weight styling */
    .custom-weight-group{background:#f8f9fa;padding:15px;border-radius:15px;border:2px solid #e9ecef}
    .custom-weight-label{display:block;font-weight:600;margin-bottom:10px;color:#495057;font-size:.95em}
    .custom-weight-controls{display:flex;align-items:center;gap:8px}
    .weight-btn{background:#fff;border:2px solid #00A8E9;color:#00A8E9;width:40px;height:40px;border-radius:8px;font-size:1.2em;font-weight:bold;cursor:pointer;transition:.2s;display:flex;align-items:center;justify-content:center}
    .weight-btn:hover{background:#00A8E9;color:#fff;transform:scale(1.1)}
    .weight-btn:active{transform:scale(0.95)}
    .custom-weight-input{flex:1;display:flex;align-items:center;gap:8px}
    #customWeightInput{flex:1;padding:10px;border:2px solid #e9ecef;border-radius:8px;font-size:1em;font-weight:600;text-align:center;background:#fff;color:#00A8E9}
    #customWeightInput:focus{outline:none;border-color:#00A8E9;box-shadow:0 0 0 3px rgba(0,168,233,.1)}
    .custom-weight-unit{font-weight:600;color:#6c757d;font-size:.95em}

    .preset-buttons{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
    .preset-btn{background:#fff;border:2px solid #e9ecef;padding:10px;border-radius:10px;cursor:pointer;transition:.3s;text-align:center;font-size:.9em}
    .preset-btn:hover{background:#00A8E9;color:#fff;border-color:#00A8E9;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,168,233,.3)}
    .preset-icon{font-size:1.5em;display:block;margin-bottom:5px}
    .preset-label{font-size:.85em;font-weight:600}
    .preset-weight{font-size:.75em;color:#6c757d;margin-top:3px}

    .visualization-container{background:#f8f9fa;border-radius:15px;padding:15px;border:2px solid #e9ecef;height:600px;position:relative}
    #visualization{
      position:relative;height:100%;
      background:linear-gradient(to bottom, rgba(135,206,235,.3) 0%, rgba(255,255,255,.1) 60%, rgba(101,67,33,.12) 100%);
      border-radius:10px;overflow:hidden;transition:filter .25s ease;
    }

    /* SEA band (boat floats) */
    .sea{
      position:absolute;left:0;right:0;bottom:var(--ground-h);
      height:var(--sea-h);
      background:linear-gradient(180deg, rgba(0,149,255,.9), rgba(0,96,191,.95));
      z-index:1;
    }
    /* simple wave shine */
    .sea::after{
      content:'';position:absolute;left:0;right:0;top:0;bottom:0;
      background:repeating-linear-gradient( -5deg, rgba(255,255,255,.15), rgba(255,255,255,.15) 6px, transparent 7px, transparent 16px);
      opacity:.5;animation:waves 6s linear infinite;
    }
    @keyframes waves{from{transform:translateX(0)}to{transform:translateX(-80px)}}

    .height-scale{position:absolute;right:10px;top:0;bottom:var(--ground-h);width:50px;display:flex;flex-direction:column;justify-content:space-between;pointer-events:none;z-index:2}
    .scale-mark{
      position:absolute;right:0;font-size:.85em;color:#495057;font-weight:700;padding:3px 6px;background:rgba(255,255,255,.9);
      border-radius:4px;border:2px solid #00A8E9;box-shadow:0 2px 4px rgba(0,0,0,.1)
    }
    .scale-mark::before{content:'';position:absolute;left:-20px;top:50%;transform:translateY(-50%);width:20px;height:2px;background:#00A8E9}

    /* reference dotted lines */
    .reference-height-line{position:absolute;left:0;right:0;height:2px;border-top:2px dotted rgba(0,168,233,.5);pointer-events:none;z-index:2}

    .stats-display{
      position:absolute;top:15px;left:15px;background:rgba(255,255,255,.95);
      padding:12px 15px;border-radius:10px;border:2px solid #e9ecef;box-shadow:0 4px 15px rgba(0,0,0,.1);z-index:10;font-size:.85em
    }
    .stats-display-mobile{display:none;background:rgba(255,255,255,.95);padding:10px 15px;border-radius:10px;border:2px solid #e9ecef;box-shadow:0 4px 15px rgba(0,0,0,.1);font-size:.8em;margin-bottom:10px}
    .stat-row{display:flex;justify-content:space-between;align-items:center;gap:15px;margin-bottom:5px;white-space:nowrap}
    .stat-row:last-child{margin-bottom:0}
    .stat-label{color:#6c757d;font-weight:600;display:flex;align-items:center;gap:5px}
    .stat-value{font-weight:bold}
    .stat-row.total .stat-value{color:#00A8E9}
    .stat-row.safe .stat-value{color:#28a745}
    .stat-row.lives .stat-value{color:#dc3545}
    .stat-row.injuries .stat-value{color:#fd7e14}

    .falling-object{position:absolute;font-size:2.5em;z-index:5;left:50%;transform:translateX(-50%);filter:drop-shadow(2px 2px 4px rgba(0,0,0,.3))}
    @keyframes fall{
      from{top:var(--start-height);transform:translateX(-50%) rotate(0deg)}
      to{top:calc(100% - calc(var(--ground-h) + 80px));transform:translateX(-50%) rotate(720deg)}
    }

    /* Ground (soil) */
    .ground{
      position:absolute;left:0;right:0;bottom:0;height:var(--ground-h);
      background:linear-gradient(to bottom,#8B4513 0%,#654321 100%);border-top:3px solid #5D4037;
      display:flex;align-items:flex-end;justify-content:center;padding-bottom:5px;z-index:3;overflow:visible;
    }
    .ground::before{content:'ğŸŒ± ğŸŒ¾ ğŸŒ¿';position:absolute;top:-15px;font-size:1.2em;width:100%;text-align:center;letter-spacing:30px}

    /* Graveyard in the soil (right) */
    #graveyardGround {
    position:absolute;
    right:10px;
    bottom:6px;
    display:flex;
    flex-direction:row; /* âœ… horizontal */
    gap:6px;
    z-index:4;
    pointer-events:none;
align-items:flex-end; /* pour qu'ils reposent bien sur le sol */
}
    .grave{font-size:1.6em;opacity:0;transform:translateY(10px) scale(.9)}
    @keyframes gravePop{to{opacity:1;transform:translateY(0) scale(1)}}

    /* Death Counts label */
    #deathCountsLabel{
      position:absolute;
      right:10px;
      bottom:calc(var(--ground-h) - 35px);
      font-weight:900;
      font-size:1.1em;
      color:#888;
      letter-spacing:2px;
      z-index:5;
      opacity:0;
      transition:opacity .3s;
      filter:drop-shadow(0 0 15px rgba(0,0,0,0.5)) drop-shadow(0 0 8px rgba(0,0,0,0.4));
      text-shadow:
        0 0 20px rgba(0,0,0,0.6),
        0 0 40px rgba(0,0,0,0.4),
        0 0 60px rgba(0,0,0,0.3),
        2px 2px 4px rgba(0,0,0,0.8);
    }
    #deathCountsLabel.show{opacity:1}


    .person{font-size:3em;z-index:6;position:absolute;bottom:calc(var(--ground-h) - 20px);left:50%;transform:translateX(-50%);filter:drop-shadow(2px 2px 4px rgba(0,0,0,.3))}
    .impact-effect{position:absolute;bottom:calc(var(--ground-h) + 40px);left:50%;transform:translateX(-50%);font-size:4em;z-index:7;opacity:0;transition:opacity .3s}
    .impact-effect.show{opacity:1;animation:impact .5s ease-out}
    @keyframes impact{0%{transform:translateX(-50%) scale(.5)}50%{transform:translateX(-50%) scale(1.3)}100%{transform:translateX(-50%) scale(1)}}

    .speech-bubble{
      position:absolute;bottom:calc(var(--ground-h) + 100px);left:50%;transform:translateX(-50%);
      background:#fff;padding:10px 15px;border-radius:15px;border:2px solid #495057;font-weight:600;font-size:.9em;max-width:200px;text-align:center;z-index:8;opacity:0;transition:opacity .3s;box-shadow:0 3px 10px rgba(0,0,0,.2)
    }
    .speech-bubble::after{content:'';position:absolute;bottom:-10px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:10px solid transparent;border-right:10px solid transparent;border-top:10px solid #fff}
    .speech-bubble.show{opacity:1;animation:bubble .3s ease-out}
    @keyframes bubble{0%{transform:translateX(-50%) scale(0)}50%{transform:translateX(-50%) scale(1.1)}100%{transform:translateX(-50%) scale(1)}}

    .reference-item{position:absolute;right:60px;display:flex;align-items:center;gap:8px;background:rgba(255,255,255,.5);padding:5px 10px;border-radius:8px;font-size:.8em;border:2px solid rgba(233,236,239,.5);z-index:4;opacity:.6;transition:.3s}
    .reference-icon{font-size:1.3em}
    .reference-label{font-weight:600;color:#495057}

    .simulate-btn{
      background:linear-gradient(135deg,#00A8E9 0%,#000E47 100%);color:#fff;border:none;padding:15px 30px;border-radius:12px;
      font-size:1.1em;font-weight:bold;cursor:pointer;transition:.3s;box-shadow:0 4px 15px rgba(0,168,233,.3)
    }
    .simulate-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,168,233,.4)}

    /* Indicator (top center) */
    .integrated-indicator{
      position:absolute;top:15px;left:50%;transform:translateX(-50%);background:#fff;padding:12px 20px;border-radius:12px;border:3px solid #28a745;box-shadow:0 4px 15px rgba(0,0,0,.15);z-index:10;display:none;align-items:center;gap:10px;transition:.3s
    }
    .integrated-indicator.show{display:flex}
    .integrated-indicator.slight{border-color:#28a745;background:linear-gradient(135deg,#28a745 0%,#20c997 100%);color:#fff}
    .integrated-indicator.minor{border-color:#ffc107;background:linear-gradient(135deg,#ffc107 0%,#ff9800 100%);color:#fff}
    .integrated-indicator.major{border-color:#fd7e14;background:linear-gradient(135deg,#fd7e14 0%,#dc3545 100%);color:#fff}
    .integrated-indicator.fatality{border-color:#dc3545;background:linear-gradient(135deg,#dc3545 0%,#c82333 100%);color:#fff}
    .indicator-icon{font-size:1.8em}
    .indicator-text{font-weight:bold;font-size:1.1em}
    .indicator-energy{font-size:.9em;opacity:.95;margin-left:5px;padding-left:10px;border-left:2px solid rgba(255,255,255,.5)}

    /* Random events (right->left) */
    .event{position:absolute;pointer-events:none;z-index:5;filter:drop-shadow(1px 1px 2px rgba(0,0,0,.2))}
    .event .emoji{font-size:2em;display:inline-block}

    /* Birds fly RIGHT->LEFT */
    .bird{left:110%;top:10%;font-size:1.4em}
    @keyframes flyLeft{from{left:110%;transform:translateY(0)}to{left:-10%;transform:translateY(-10px)}}

    /* Boat sails on sea surface RIGHT->LEFT */
    .boat{left:110%;z-index:5}
    @keyframes sailLeft{from{left:110%}to{left:-20%}}

    /* Mole (neutral) */
    .mole{left:10%;bottom:calc(var(--ground-h) - 4px);z-index:6}
    .mole .emoji{font-size:1.8em;transform:translateY(100%)}
    @keyframes pop{0%,100%{transform:translateY(100%)}20%,80%{transform:translateY(0%)}}

    /* Ambulance RIGHT->LEFT on ground lane */
    .ambulance{left:110%;bottom:calc(var(--ground-h) - 20px);z-index:7}
    .ambulance .emoji{font-size:2.2em}
    .ambulance .siren{
      position:absolute;top:-8px;left:50%;transform:translateX(-50%);
      width:14px;height:8px;background:red;border-radius:2px;box-shadow:0 0 10px rgba(255,0,0,.9);
      animation:siren .4s infinite alternate
    }
    @keyframes siren{
      0%{background:red;box-shadow:0 0 10px rgba(255,0,0,.9)}
      100%{background:dodgerblue;box-shadow:0 0 10px rgba(30,144,255,.9)}
    }
    @keyframes driveLeft{from{left:110%}to{left:-20%}}
    @keyframes bandageFloat{
      0%{opacity:0;transform:translateX(-50%) scale(0)}
      50%{opacity:1;transform:translateX(-50%) scale(1.2)}
      100%{opacity:0;transform:translateX(-50%) translateY(-30px) scale(1)}
    }
    @keyframes reaperAppear{
      0%{opacity:0;transform:translateX(-50%) scale(0) rotateZ(-45deg)}
      50%{opacity:1;transform:translateX(-50%) scale(1) rotateZ(0deg)}
      100%{opacity:1;transform:translateX(-50%) scale(1) rotateZ(0deg)}
    }

    /* FATALITY overlay */
    #fatalOverlay{
      position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
      font-weight:900;font-size:64px;color:#ff2d2d;text-shadow:0 4px 16px rgba(0,0,0,.6);
      letter-spacing:4px;opacity:0;transform:scale(.9);z-index:20;pointer-events:none
    }
    @keyframes fatalShow{
      0%{opacity:0;transform:scale(.9)}
      30%{opacity:1;transform:scale(1.02)}
      60%{opacity:1;transform:scale(1)}
      100%{opacity:0;transform:scale(1)}
    }
    #visualization.drama{filter:grayscale(.8) blur(1px) brightness(.9)}

    /* Tables */
    .bottom-tables{display:grid;grid-template-columns:1fr 1fr;gap:20px}
    .severity-table{background:#f8f9fa;padding:15px;border-radius:15px;border:2px solid #e9ecef}
    .severity-table h3{
      color:#fff;background:linear-gradient(135deg,#fd7e14 0%,#dc3545 100%);
      font-size:1.1em;font-weight:bold;margin:-15px -15px 15px;padding:12px 15px;text-align:center;border-radius:15px 15px 0 0;box-shadow:0 2px 8px rgba(0,0,0,.1);text-transform:uppercase;letter-spacing:.5px
    }
    .severity-row{display:flex;align-items:center;gap:12px;padding:12px;margin-bottom:8px;border-radius:10px;border:3px solid transparent;background:#fff;transition:.3s;cursor:pointer}
    .severity-row:last-child{margin-bottom:0}
    .severity-row.active{transform:translateX(5px);box-shadow:0 4px 15px rgba(0,0,0,.15)}
    .severity-row.slight{border-color:#28a745}
    .severity-row.slight.active{background:linear-gradient(135deg,#28a745 0%,#20c997 100%);color:#fff}
    .severity-row.minor{border-color:#ffc107}
    .severity-row.minor.active{background:linear-gradient(135deg,#ffc107 0%,#ff9800 100%);color:#fff}
    .severity-row.major{border-color:#fd7e14}
    .severity-row.major.active{background:linear-gradient(135deg,#fd7e14 0%,#dc3545 100%);color:#fff}
    .severity-row.fatality{border-color:#dc3545}
    .severity-row.fatality.active{background:linear-gradient(135deg,#dc3545 0%,#c82333 100%);color:#fff}
    .severity-icon{font-size:2em}
    .equivalence-table{background:#f8f9fa;padding:15px;border-radius:15px;border:2px solid #e9ecef;display:flex;flex-direction:column}
    .equivalence-table h3{
      color:#fff;background:linear-gradient(135deg,#00A8E9 0%,#000E47 100%);
      font-size:1.1em;font-weight:bold;margin:-15px -15px 15px;padding:12px 15px;text-align:center;border-radius:15px 15px 0 0;box-shadow:0 2px 8px rgba(0,0,0,.1);text-transform:uppercase;letter-spacing:.5px
    }
    .equivalence-display-large{display:flex;align-items:center;gap:15px;padding:16px;background:#fff;border-radius:12px;border:2px solid #00A8E9;margin-bottom:12px}
    .equivalence-icon-large{font-size:2.2em}
    .equivalence-text-large{flex:1;font-size:1em;line-height:1.4;color:#495057}
    .energy-display{font-size:1em;font-weight:bold;color:#00A8E9}
    #equivalenceRows{max-height:320px;overflow-y:auto;overflow-x:hidden;scrollbar-width:thin;scrollbar-color:#00A8E9 #e9ecef}
    #equivalenceRows::-webkit-scrollbar{width:8px}
    #equivalenceRows::-webkit-scrollbar-track{background:#e9ecef;border-radius:10px}
    #equivalenceRows::-webkit-scrollbar-thumb{background:#00A8E9;border-radius:10px}
    #equivalenceRows::-webkit-scrollbar-thumb:hover{background:#0088c9}
    .equivalence-row{display:flex;align-items:center;gap:12px;padding:12px;margin-bottom:8px;border-radius:10px;border:2px solid #e9ecef;background:#fff;transition:.3s}
    .equivalence-row:last-child{margin-bottom:0}
    .equivalence-row.active{border-color:#00A8E9;background:linear-gradient(135deg,#00A8E9 0%,#000E47 100%);color:#fff;transform:translateX(5px);box-shadow:0 4px 15px rgba(0,168,233,.4)}
    .equivalence-icon{font-size:1.8em}
    .equivalence-label{font-weight:600;font-size:.9em;line-height:1.3}
    .equivalence-energy{font-size:.75em;opacity:.7}
    .equivalence-row.active .equivalence-energy{opacity:.9}

    /* Responsive */
    @media (max-width:1400px){.container{max-width:100%}.top-section{grid-template-columns:280px 1fr}}
    @media (max-width:1024px){
      .top-section{grid-template-columns:1fr}
      .left-column{order:2}
      .visualization-container{order:1;height:500px}
      .bottom-tables{grid-template-columns:1fr}
    }
    @media (max-width:768px){
      body{padding:5px}
      .mobile-nav{display:block}
      .container{border-radius:15px;margin-top:140px}
      .header{padding:20px 15px}
      .header-top{flex-direction:column;gap:15px;min-height:auto}
      .header-logo{height:60px}
      .header h1{font-size:1.5em}
      .header p{font-size:.9em}
      .header-description{font-size:.85em}
      .main-grid{padding:10px;gap:20px}
      .top-section{display:grid;grid-template-columns:1fr;gap:30px}
      .left-column{width:100%;margin-top:30px}
      .visualization-container{height:240px;padding:10px;width:100%}
      .visualization-container .stats-display{display:none!important}
      .stats-display-mobile{display:block!important}
      .preset-buttons{grid-template-columns:repeat(2,1fr);gap:8px}
      .falling-object{font-size:2em}
      .person{font-size:2.5em}
      .integrated-indicator{padding:8px 15px;font-size:.9em}
      .indicator-icon{font-size:1.5em}
      .indicator-text{font-size:1em}
      .indicator-energy{font-size:.85em}
      .bottom-tables{grid-template-columns:1fr;gap:15px}
      .left-column{position:relative;z-index:15}
      .controls{position:relative;z-index:15}
      input[type=range]{position:relative;z-index:16}
    }
    @media (max-width:480px){
      .header h1{font-size:1.2em}
      .preset-buttons{grid-template-columns:1fr}
      .visualization-container{height:350px}
      .falling-object{font-size:1.5em}
      .person{font-size:2em}
      .speech-bubble{font-size:.8em;max-width:150px;padding:8px 12px}
      .integrated-indicator{flex-direction:column;text-align:center;gap:5px;padding:8px 12px}
      .indicator-energy{border-left:none;border-top:2px solid rgba(255,255,255,.5);padding-left:0;padding-top:5px;margin-left:0}
    }
  </style>
</head>
<body>
  <!-- Mobile Navigation -->
  <div class="mobile-nav">
    <div class="header-logos-mobile">
      <img src="./logo_cou.png" alt="Courseulles Logo" class="header-logo-mobile">
      <img src="./logo_drop.png" alt="Drop Logo" class="header-logo-mobile">
    </div>
    <div class="nav-title">ğŸ“¦ Falling Object Impact Simulator</div>
    <div class="nav-buttons">
      <button class="nav-btn active" onclick="showSection(event,'controls')">ğŸ® Controls</button>
      <button class="nav-btn" onclick="showSection(event,'visualization')">ğŸ“Š Visualization</button>
      <button class="nav-btn" onclick="showSection(event,'severity')">âš ï¸ Severity Levels</button>
      <button class="nav-btn" onclick="showSection(event,'equivalence')">ğŸ“ˆ Energy Equivalence</button>
    </div>
  </div>

  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="header-top">
        <img src="./logo_cou.png" alt="Courseulles Logo" class="header-logo">
        <div class="header-content">
          <h1>ğŸ“¦ Falling Object Impact Simulator</h1>
          <p>Understand the impact of falling objects <span class="lightning-easter-egg" id="lightningEgg" title="Click for a surprise!">âš¡</span></p>
          <div class="header-description">Explore the dangers of falling objects in professional environments</div>
        </div>
        <img src="./logo_drop.png" alt="Drop Logo" class="header-logo">
      </div>
    </div>

    <!-- Main -->
    <div class="main-grid">
      <div class="top-section">
        <!-- Left: Controls -->
        <div class="left-column">
          <div class="controls">
            <div class="control-group">
              <label>ğŸ“ Drop Height</label>
              <div class="slider-container">
                <input type="range" id="heightInput" min="0.1" max="50" step="0.1" value="2">
                <span class="height-value" id="heightValue">2.0 m</span>
              </div>
            </div>

            <div class="control-group">
              <div class="collapsible-header" id="presetsHeader" onclick="togglePresets()">
                <label>âš™ï¸ Predefined Objects</label>
                <span class="collapsible-arrow">â–¼</span>
              </div>
              <div class="collapsible-content" id="presetsContent">
                <div class="preset-buttons" id="presetButtons"></div>
              </div>
            </div>

            <div class="custom-weight-group">
              <label class="custom-weight-label">â­ Custom Weight</label>
              <div class="custom-weight-controls">
                <button class="weight-btn" onclick="decreaseWeight()">âˆ’</button>
                <div class="custom-weight-input">
                  <input type="number" id="customWeightInput" min="0.01" max="100" step="0.01" placeholder="1.0" value="1.0">
                  <span class="custom-weight-unit">kg</span>
                </div>
                <button class="weight-btn" onclick="increaseWeight()">+</button>
              </div>
            </div>

            <button class="simulate-btn" onclick="simulateFall()">ğŸ¬ Run Simulation</button>
          </div>
        </div>

        <!-- Right: Visualization -->
        <div class="visualization-container">
          <!-- Mobile stats -->
          <div class="stats-display-mobile">
            <div class="stat-row total"><span class="stat-label">ğŸ¯ Total:</span><span class="stat-value" id="totalSimulationsMobile">0</span></div>
            <div class="stat-row safe"><span class="stat-label">âœ… Safe:</span><span class="stat-value" id="safeSimulationsMobile">0</span></div>
            <div class="stat-row lives"><span class="stat-label">ğŸ’€ Deaths:</span><span class="stat-value" id="preventedDeathsMobile">0</span></div>
            <div class="stat-row injuries"><span class="stat-label">ğŸ¥ Injuries:</span><span class="stat-value" id="preventedInjuriesMobile">0</span></div>
          </div>

          <div id="visualization">
            <!-- FATALITY overlay -->
            <div id="fatalOverlay">You Killed Him ğŸ˜± !</div>

            <!-- Sea layer -->
            <div class="sea" aria-hidden="true"></div>

            <div class="height-scale" id="heightScale"></div>

            <!-- Stats bubble -->
            <div class="stats-display">
              <div class="stat-row total"><span class="stat-label">ğŸ¯ Total Simulations:</span><span class="stat-value" id="totalSimulations">0</span></div>
              <div class="stat-row safe"><span class="stat-label">âœ… Safe Simulations:</span><span class="stat-value" id="safeSimulations">0</span></div>
              <div class="stat-row lives"><span class="stat-label">ğŸ’€ Deaths:</span><span class="stat-value" id="preventedDeaths">0</span></div>
              <div class="stat-row injuries"><span class="stat-label">ğŸ¥ Injuries:</span><span class="stat-value" id="preventedInjuries">0</span></div>
            </div>

            <!-- Integrated indicator -->
            <div class="integrated-indicator" id="integratedIndicator">
              <div class="indicator-icon" id="indicatorIcon">ğŸ¤•</div>
              <div class="indicator-text" id="indicatorText">Slight</div>
              <div class="indicator-energy" id="indicatorEnergy">0 J</div>
            </div>

            <div class="falling-object" id="fallingObject">ğŸ“¦</div>

            <!-- Reference heights -->
            <div class="reference-item" id="ref-car"><span class="reference-icon">ğŸš—</span><span class="reference-label">Car (1.5m)</span></div>
            <div class="reference-item" id="ref-truck"><span class="reference-icon">ğŸšš</span><span class="reference-label">Truck (3.5m)</span></div>
            <div class="reference-item" id="ref-building"><span class="reference-icon">ğŸ¢</span><span class="reference-label">Building (10m)</span></div>
            <div class="reference-item" id="ref-crane"><span class="reference-icon">ğŸ—ï¸</span><span class="reference-label">Crane (30m)</span></div>
            <div class="reference-item" id="ref-arc"><span class="reference-icon">ğŸ¡</span><span class="reference-label">Arc de Triomphe (50m)</span></div>

            <!-- Ground -->
            <div class="ground">
              <!-- Death Counts Label -->
              <div id="deathCountsLabel">DEATH COUNTS</div>

              <!-- Graveyard in soil -->
              <div id="graveyardGround" aria-live="polite"></div>

              <div class="person" id="person">ğŸ§</div>
              <div class="impact-effect" id="impactEffect">ğŸ’¥</div>
              <div class="speech-bubble" id="speechBubble">Ouch!</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Bottom tables -->
      <div class="bottom-tables">
        <div class="severity-table">
          <h3>âš ï¸ Severity Levels</h3>
          <div class="severity-row slight" id="severity-slight">
            <div class="severity-icon">ğŸ¤•</div><div class="severity-info"><div class="severity-title">Slight</div><div class="severity-threshold">&lt; 15 J</div></div>
          </div>
          <div class="severity-row minor" id="severity-minor">
            <div class="severity-icon">ğŸ˜µ</div><div class="severity-info"><div class="severity-title">Minor</div><div class="severity-threshold">15â€“50 J</div></div>
          </div>
          <div class="severity-row major" id="severity-major">
            <div class="severity-icon">ğŸš‘</div><div class="severity-info"><div class="severity-title">Major</div><div class="severity-threshold">50â€“100 J</div></div>
          </div>
          <div class="severity-row fatality" id="severity-fatality">
            <div class="severity-icon">ğŸ’€</div><div class="severity-info"><div class="severity-title">Fatality</div><div class="severity-threshold">&gt; 100 J</div></div>
          </div>
        </div>

        <div class="equivalence-table">
          <h3>ğŸ“Š Energy Equivalence</h3>
          <div id="equivalenceFeatured" class="equivalence-display-large" aria-live="polite"></div>
          <div id="equivalenceRows"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Physics & thresholds
    const g = 9.81;
    const THRESHOLDS = { slight: 15, minor: 50, major: 100 };

    const PRESETS = [
      { icon: 'ğŸ”©', label: 'Bolt', weight: 0.05, desc: '50g' },
      { icon: 'ğŸ”§', label: 'Wrench', weight: 0.5, desc: '500g' },
      { icon: 'ğŸ”¨', label: 'Hammer', weight: 1, desc: '1kg' },
      { icon: 'ğŸ“±', label: 'Phone', weight: 0.2, desc: '200g' },
      { icon: 'âš™ï¸', label: 'Heavy Tool', weight: 2, desc: '2kg' },
      { icon: 'ğŸª£', label: 'Bucket', weight: 0.3, desc: '300g' },
      { icon: 'ğŸ§°', label: 'Toolbox', weight: 5, desc: '5kg' },
      { icon: 'â›‘ï¸', label: 'Helmet', weight: 1.5, desc: '1.5kg' }
    ];

    const EQUIVALENCES = [
      { maxEnergy: 1, icon: 'ğŸª¶', text: 'Falling feather' },
      { maxEnergy: 3, icon: 'ğŸƒ', text: 'Falling leaf' },
      { maxEnergy: 5, icon: 'ğŸˆ', text: 'Party balloon drop' },
      { maxEnergy: 10, icon: 'ğŸ“', text: 'Ping pong ball impact' },
      { maxEnergy: 15, icon: 'ğŸ¾', text: 'Tennis ball throw' },
      { maxEnergy: 20, icon: 'âš¾', text: 'Baseball throw' },
      { maxEnergy: 30, icon: 'ğŸ€', text: 'Basketball impact' },
      { maxEnergy: 40, icon: 'ğŸ¥', text: 'Softball hit' },
      { maxEnergy: 50, icon: 'ğŸ¥Š', text: 'Amateur boxer punch' },
      { maxEnergy: 70, icon: 'ğŸ¯', text: 'Dart board impact' },
      { maxEnergy: 100, icon: 'ğŸ—ï¸', text: 'Small construction tool' },
      { maxEnergy: 150, icon: 'ğŸ”¨', text: 'Heavy hammer blow' },
      { maxEnergy: 200, icon: 'ğŸš—', text: 'Low-speed car bump' },
      { maxEnergy: 300, icon: 'ğŸ‹ï¸', text: 'Dropped weight plate' },
      { maxEnergy: 400, icon: 'ğŸ› ï¸', text: 'Heavy machinery part' },
      { maxEnergy: 500, icon: 'ğŸ’¥', text: 'Severe construction accident' },
      { maxEnergy: 750, icon: 'âš ï¸', text: 'Critical injury zone' },
      { maxEnergy: 1000, icon: 'ğŸš¨', text: 'Extreme danger level' },
      { maxEnergy: 1500, icon: 'â˜ ï¸', text: 'Fatal impact zone' },
      { maxEnergy: Infinity, icon: 'ğŸ’€', text: 'Catastrophic - Maximum risk' }
    ];

    const SPEECH_BUBBLES = {
      slight: ['Ouch!', 'That hurts!', 'Oops!', 'Watch out!'],
      minor: ['Ow ow!', 'That really hurts!', "I'm hurt!", 'Call for help!'],
      major: ['AAAAH!', 'Help!', "I'm injured!", 'Medical emergency!'],
      fatality: ['...', 'Fatal accident', 'Too late...', 'ğŸ’€']
    };

    // State
    let safetyStats = { preventedDeaths: 0, preventedInjuries: 0, safeSimulations: 0, totalSimulations: 0 };
    let currentWeight = 1, currentHeight = 2, isMobile = window.innerWidth <= 768;

    // DOM
    const heightInput = document.getElementById('heightInput');
    const heightValue = document.getElementById('heightValue');
    const customWeightInput = document.getElementById('customWeightInput');
    const fallingObject = document.getElementById('fallingObject');
    const person = document.getElementById('person');
    const impactEffect = document.getElementById('impactEffect');
    const speechBubble = document.getElementById('speechBubble');
    const heightScale = document.getElementById('heightScale');
    const visualization = document.getElementById('visualization');
    const fatalOverlay = document.getElementById('fatalOverlay');
    const graveyardGround = document.getElementById('graveyardGround');

    // Persistence
    function loadStats(){
      const saved = localStorage.getItem('safetyStats');
      if(saved){
        safetyStats = JSON.parse(saved);
        updateStatsDisplay();
      }
    }
    function saveStats(){ localStorage.setItem('safetyStats', JSON.stringify(safetyStats)); }

    function updateStatsDisplay(){
      document.getElementById('totalSimulations').textContent = safetyStats.totalSimulations;
      document.getElementById('preventedInjuries').textContent = safetyStats.preventedInjuries;
      document.getElementById('safeSimulations').textContent = safetyStats.safeSimulations;
      document.getElementById('preventedDeaths').textContent = safetyStats.preventedDeaths;

      document.getElementById('totalSimulationsMobile').textContent = safetyStats.totalSimulations;
      document.getElementById('preventedInjuriesMobile').textContent = safetyStats.preventedInjuries;
      document.getElementById('safeSimulationsMobile').textContent = safetyStats.safeSimulations;
      document.getElementById('preventedDeathsMobile').textContent = safetyStats.preventedDeaths;
    }

    // Presets
    function togglePresets(){
      const header = document.getElementById('presetsHeader');
      const content = document.getElementById('presetsContent');
      header.classList.toggle('collapsed');
      content.classList.toggle('collapsed');
    }
    function createPresets(){
      const container = document.getElementById('presetButtons');
      PRESETS.forEach(p=>{
        const btn = document.createElement('button');
        btn.className='preset-btn';
        btn.innerHTML = `
          <span class="preset-icon">${p.icon}</span>
          <div class="preset-label">${p.label}</div>
          <div class="preset-weight">${p.desc}</div>
        `;
        btn.onclick = ()=>{
          currentWeight = p.weight;
          fallingObject.textContent = p.icon;
          customWeightInput.value = '';
          updateDisplay();
        };
        container.appendChild(btn);
      });
    }

    // Equivalences
    function createEquivalenceRows(){
      const container = document.getElementById('equivalenceRows');
      container.innerHTML='';
      EQUIVALENCES.forEach(eq=>{
        const row = document.createElement('div');
        row.className='equivalence-row';
        row.dataset.maxEnergy = eq.maxEnergy;
        row.innerHTML = `
          <div class="equivalence-icon">${eq.icon}</div>
          <div class="equivalence-info">
            <div class="equivalence-label">${eq.text}</div>
            <div class="equivalence-energy">${eq.maxEnergy===Infinity ? '1500+' : 'â‰¤ '+eq.maxEnergy} J</div>
          </div>
        `;
        container.appendChild(row);
      });
    }
    function getEquivalence(energy){
      for(const e of EQUIVALENCES) if(energy <= e.maxEnergy) return e;
      return EQUIVALENCES[EQUIVALENCES.length-1];
    }
    function updateFeaturedEquivalence(energy){
      const featured = document.getElementById('equivalenceFeatured');
      const eq = getEquivalence(energy);
      featured.innerHTML = `
        <div class="equivalence-icon-large">${eq.icon}</div>
        <div class="equivalence-text-large"><strong>${eq.text}</strong><br><span class="energy-display">${energy.toFixed(1)} J</span></div>
      `;
    }
    function updateEquivalenceRows(energy){
      const rows = document.querySelectorAll('.equivalence-row');
      rows.forEach(r=>r.classList.remove('active'));
      let idx=0;
      for(let i=0;i<rows.length;i++){
        const maxE = parseFloat(rows[i].dataset.maxEnergy);
        if(energy<=maxE){idx=i;break;}
      }
      if(rows[idx]){
        rows[idx].classList.add('active');
        const cont=document.getElementById('equivalenceRows');
        const active=rows[idx];
        const ch=cont.offsetHeight, top=active.offsetTop, h=active.offsetHeight;
        cont.scrollTo({top: top-(ch/2)+(h/2), behavior:'smooth'});
      }
      updateFeaturedEquivalence(energy);
    }

    // Scale & references
    function getDynamicMaxHeight(h){
      const m=h*1.3, r=Math.ceil(m/10)*10;
      return Math.max(10,r);
    }
    function updateHeightScale(){
      heightScale.innerHTML='';
      const dynamicMaxHeight = getDynamicMaxHeight(currentHeight);
      const marks=[];
      const interval = dynamicMaxHeight<=20 ? 5 : 10;
      for(let i=0;i<=dynamicMaxHeight;i+=interval) marks.push(i);
      marks.forEach(mark=>{
        if(mark<=dynamicMaxHeight){
          const div=document.createElement('div');
          div.className='scale-mark';
          div.textContent=mark+'m';
          div.style.top = (100 - (mark/dynamicMaxHeight)*100) + '%';
          heightScale.appendChild(div);
        }
      });

      const vizH = visualization.offsetHeight;
      const usableH = vizH - parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--ground-h'));
      visualization.querySelectorAll('.reference-height-line').forEach(l=>l.remove());

      const refs = [
        { id:'ref-car', height:1.5 },
        { id:'ref-truck', height:3.5 },
        { id:'ref-building', height:10 },
        { id:'ref-crane', height:30 },
        { id:'ref-arc', height:50 }
      ];
      refs.forEach(ref=>{
        const el=document.getElementById(ref.id);
        if(!el) return;
        if(ref.height<=dynamicMaxHeight){
          const pos = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--ground-h')) + (ref.height/dynamicMaxHeight)*usableH;
          el.style.position='absolute';
          el.style.bottom=pos+'px';
          el.style.right='60px';
          el.style.display='flex';

          const line=document.createElement('div');
          line.className='reference-height-line';
          line.style.bottom=pos+'px';
          visualization.appendChild(line);
        }else{
          el.style.display='none';
        }
      });
    }

    // Physics helpers
    function calculateEnergy(mass,height){return mass*g*height}
    function getDamageLevel(energy){
      if(energy < THRESHOLDS.slight) return 'slight';
      if(energy < THRESHOLDS.minor) return 'minor';
      if(energy < THRESHOLDS.major) return 'major';
      return 'fatality';
    }

    // UI update
    function updateDisplay(){
      currentWeight = parseFloat(currentWeight);
      currentHeight = parseFloat(heightInput.value);
      heightValue.textContent = currentHeight.toFixed(1) + ' m';

      const energy = calculateEnergy(currentWeight,currentHeight);
      const damageLevel = getDamageLevel(energy);
      updateEquivalenceRows(energy);

      const dynMax = getDynamicMaxHeight(currentHeight);
      const vizH = visualization.offsetHeight;
      const groundH = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--ground-h'));
      const usableH = vizH - groundH;
      const topPos = ((dynMax - currentHeight)/dynMax)*usableH;
      fallingObject.style.top = topPos + 'px';

      ['slight','minor','major','fatality'].forEach(level=>{
        const row=document.getElementById('severity-'+level);
        if(level===damageLevel) row.classList.add('active'); else row.classList.remove('active');
      });

      updateHeightScale();
    }

    // Inputs
    heightInput.addEventListener('input',()=>{currentHeight=parseFloat(heightInput.value);updateDisplay();});
    customWeightInput.addEventListener('input',()=>{
      const v=parseFloat(customWeightInput.value);
      if(v && v>0){currentWeight=v;fallingObject.textContent='âš«';updateDisplay();}
    });

    function increaseWeight(){
      let v = parseFloat(customWeightInput.value) || 1;
      v = Math.min(100, v + 0.1);
      customWeightInput.value = v.toFixed(2);
      currentWeight = v;
      fallingObject.textContent='âš«';
      updateDisplay();
    }
    function decreaseWeight(){
      let v = parseFloat(customWeightInput.value) || 1;
      v = Math.max(0.01, v - 0.1);
      customWeightInput.value = v.toFixed(2);
      currentWeight = v;
      fallingObject.textContent='âš«';
      updateDisplay();
    }

    // Easter egg
    let clickCount=0;
    document.getElementById('lightningEgg').addEventListener('click',()=>{
      clickCount++;
      if(clickCount>=3){
        person.classList.add('electrocuted');person.textContent='âš¡ğŸ˜µâš¡';
        setTimeout(()=>{person.classList.remove('electrocuted');person.textContent='ğŸ§';clickCount=0;},1000);
      }
    });

    // Graveyard in soil
    function addGrave(animated=true){
      const g=document.createElement('div');
      g.className='grave';
      g.textContent='âš°ï¸';
      graveyardGround.appendChild(g);
      if(animated){ g.style.animation='gravePop 300ms ease-out forwards'; }
      else { g.style.opacity='1'; g.style.transform='translateY(0) scale(1)'; }
    }
    function renderGraveyard(){
      graveyardGround.innerHTML='';
      for(let i=0;i<(safetyStats.preventedDeaths||0);i++) addGrave(false);
    }

    // Random events every 20s
    const EVENT_INTERVAL_MS = 20000;
    function rand(min,max){return Math.random()*(max-min)+min;}

    function spawnBirds(){
      const bird=document.createElement('div');
      bird.className='event bird';
      bird.style.top = `${rand(5,30)}%`;
      bird.style.animation = `flyLeft ${rand(6,10)}s linear forwards`;
      bird.textContent = Math.random()<0.5 ? 'ğŸ¦' : 'ğŸ•Šï¸';
      visualization.appendChild(bird);
      bird.addEventListener('animationend',()=>bird.remove());
      setTimeout(()=>bird.remove(),15000);
    }
    function spawnBoat(){
      const boat=document.createElement('div');
      boat.className='event boat';
      // set on sea surface: ground height + ~sea height - small offset
      const seaH = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--sea-h'));
      const groundH = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--ground-h'));
      const surfaceBottom = groundH + (seaH - 28); // tune float height
      boat.style.bottom = `${surfaceBottom}px`;
      boat.style.animation = `sailLeft ${rand(10,14)}s linear forwards`;
      boat.textContent = Math.random()<0.5 ? 'â›µ' : 'ğŸš¤';
      visualization.appendChild(boat);
      boat.addEventListener('animationend',()=>boat.remove());
      setTimeout(()=>boat.remove(),16000);
    }
    function spawnMole(){
      const m=document.createElement('div');
      m.className='event mole';
      const vw = visualization.offsetWidth;
      const leftPct = (rand(50, vw-80)/vw)*100;
      m.style.left = `${Math.min(85,Math.max(5,leftPct))}%`;
      m.innerHTML = `<span class="emoji">ğŸ¦«</span>`;
      visualization.appendChild(m);
      const emoji=m.querySelector('.emoji');
      emoji.style.animation = `pop ${rand(1.8,2.4)}s ease-out forwards`;
      setTimeout(()=>m.remove(),3000);
    }
    function spawnAmbulance(){
      const amb=document.createElement('div');
      amb.className='event ambulance';
      amb.style.animation = `driveLeft ${rand(6,8)}s linear forwards`;
      amb.innerHTML = `<span class="siren"></span><span class="emoji">ğŸš‘</span>`;
      visualization.appendChild(amb);
      amb.addEventListener('animationend',()=>amb.remove());
      setTimeout(()=>amb.remove(),12000);
    }
    function spawnBandage(){
      const bandage=document.createElement('div');
      bandage.className='event';
      bandage.style.left = '50%';
      bandage.style.bottom = 'calc(var(--ground-h) + 40px)';
      bandage.style.transform = 'translateX(-50%)';
      bandage.style.fontSize = '2em';
      bandage.textContent = 'ğŸ©¹';
      bandage.style.animation = 'bandageFloat 1.5s ease-out forwards';
      visualization.appendChild(bandage);
      setTimeout(()=>bandage.remove(),2000);
    }
    function spawnFirefighters(){
      const ff=document.createElement('div');
      ff.className='event';
      ff.style.bottom = 'calc(var(--ground-h) - 15px)';
      ff.style.animation = `driveLeft ${rand(5,7)}s linear forwards`;
      ff.style.left = '110%';
      ff.innerHTML = `<span style="font-size:2.2em">ğŸš’</span>`;
      visualization.appendChild(ff);
      ff.addEventListener('animationend',()=>ff.remove());
      setTimeout(()=>ff.remove(),10000);
    }
    function spawnReaper(){
      const reaper=document.createElement('div');
      reaper.className='event';
      reaper.style.left = '50%';
      reaper.style.bottom = 'calc(var(--ground-h) + 60px)';
      reaper.style.transform = 'translateX(-50%)';
      reaper.style.fontSize = '2.5em';
      reaper.textContent = 'âš°ï¸';
      reaper.style.animation = 'reaperAppear 1s ease-out forwards';
      visualization.appendChild(reaper);
      setTimeout(()=>reaper.remove(),3000);
    }
    function spawnRandomEvent(){
      const r=Math.random();
      if(r<0.35) spawnBirds();
      else if(r<0.6) spawnBoat();
      else if(r<0.8) spawnMole();
      else spawnAmbulance();
    }

    // FATALITY effect
    function showFatality(){
      visualization.classList.add('drama');
      fatalOverlay.style.animation='fatalShow 1600ms ease-in-out forwards';
      setTimeout(()=>{
        visualization.classList.remove('drama');
        fatalOverlay.style.animation='none';
        fatalOverlay.style.opacity=0;
      },1700);
    }

    // Stats update + persistence
    function updateStats(damageLevel){
      safetyStats.totalSimulations++;
      if(damageLevel==='fatality'){
        safetyStats.preventedDeaths++;  // on rÃ©utilise ce compteur comme nb de dÃ©cÃ¨s
      }else if(damageLevel==='major' || damageLevel==='minor'){
        safetyStats.preventedInjuries++;
      }else{
        safetyStats.safeSimulations++;
      }
      updateStatsDisplay();
      saveStats();
      
      // Mettre Ã  jour le label Death Counts
      const label = document.getElementById('deathCountsLabel');
      if(safetyStats.preventedDeaths > 0){
        label.classList.add('show');
      }else{
        label.classList.remove('show');
      }
    }

    // Simulation
    function simulateFall(){
      if(isMobile){
        const vizCtn=document.querySelector('.visualization-container');
        if(vizCtn) vizCtn.scrollIntoView({behavior:'smooth',block:'center'});
      }
      // reset visuals
      fallingObject.style.animation='none';
      impactEffect.classList.remove('show');
      speechBubble.classList.remove('show');
      person.textContent='ğŸ§';
      const indicator = document.getElementById('integratedIndicator');
      indicator.classList.remove('show');

      void fallingObject.offsetWidth; // reflow

      setTimeout(()=>{
        const dynMax = getDynamicMaxHeight(currentHeight);
        const vizH = visualization.offsetHeight;
        const groundH = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--ground-h'));
        const usableH = vizH - groundH;
        const startPos = ((dynMax - currentHeight)/dynMax)*usableH;

        const fallTime = Math.sqrt(2*currentHeight/g);

        fallingObject.style.setProperty('--start-height', startPos+'px');
        fallingObject.style.animation = `fall ${fallTime}s linear`;

        setTimeout(()=>{
          impactEffect.classList.add('show');

          const energy = calculateEnergy(currentWeight,currentHeight);
          const damageLevel = getDamageLevel(energy);

          // Integrated indicator content & class
          const indicatorIcon = document.getElementById('indicatorIcon');
          const indicatorText = document.getElementById('indicatorText');
          const indicatorEnergy = document.getElementById('indicatorEnergy');

          indicator.className = 'integrated-indicator show ' + damageLevel;
          const map = { slight:'ğŸ¤•', minor:'ğŸ˜µ', major:'ğŸš‘', fatality:'ğŸ’€' };
          const labelMap = { slight:'Slight', minor:'Minor', major:'Major', fatality:'Fatality' };
          indicatorIcon.textContent = map[damageLevel];
          indicatorText.textContent = labelMap[damageLevel];
          indicatorEnergy.textContent = energy.toFixed(1) + ' J';

          // Stats & consequences
          updateStats(damageLevel);

          const msgs = SPEECH_BUBBLES[damageLevel];
          speechBubble.textContent = msgs[Math.floor(Math.random()*msgs.length)];
          speechBubble.classList.add('show');
          person.textContent = map[damageLevel];

          if(damageLevel==='fatality'){
            addGrave(true);     // âš°ï¸ dans le sol (droite)
            spawnAmbulance();   // ambulance
            spawnReaper();      // faucheuse âš°ï¸
            showFatality();     // overlay "You Killed Him ğŸ˜± !" + vignette
          }else if(damageLevel==='major'){
            spawnFirefighters();  // pompiers ğŸš’
          }else if(damageLevel==='minor' || damageLevel==='slight'){
            spawnBandage();  // pansement ğŸ©¹
          }

          setTimeout(()=>{
            impactEffect.classList.remove('show');
            speechBubble.classList.remove('show');
          },2500);
        }, fallTime*1000);
      },2000);
    }

    // Mobile nav
    function showSection(evt,section){
      document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
      if(evt && evt.currentTarget) evt.currentTarget.classList.add('active');
      let target;
      if(section==='controls') target=document.querySelector('.left-column');
      else if(section==='visualization') target=document.querySelector('.visualization-container');
      else if(section==='severity') target=document.querySelector('.severity-table');
      else if(section==='equivalence') target=document.querySelector('.equivalence-table');
      if(target) target.scrollIntoView({behavior:'smooth',block:'start'});
    }

    // Resize
    window.addEventListener('resize', ()=>{
      isMobile = window.innerWidth <= 768;
      updateHeightScale();
      updateDisplay();
    });

    // Init
    loadStats();
    createPresets();
    createEquivalenceRows();
    updateHeightScale();
    updateDisplay();
    renderGraveyard();
    
    // Initialiser le label Death Counts
    const label = document.getElementById('deathCountsLabel');
    if(safetyStats.preventedDeaths > 0){
      label.classList.add('show');
    }

    // Events clock (every 20s) + one immediately
    spawnRandomEvent();
    setInterval(spawnRandomEvent, 20000);

    // Post-layout sync
    setTimeout(()=>{ const e=calculateEnergy(currentWeight,currentHeight); updateEquivalenceRows(e); },100);
  </script>
</body>
</html>