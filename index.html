<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dropped Object Impact Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            overflow-x: hidden;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #00A8E9 0%, #000E47 100%);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
            width: 100%;
            max-width: 100vw;
        }

        /* Navigation mobile - cach√©e sur desktop */
        .mobile-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #00A8E9 0%, #000E47 100%);
            padding: 10px;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            display: none;
        }

        .header-logos-mobile {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 10px;
            margin-bottom: 5px;
        }

        .header-logo-mobile {
            max-height: 50px;
            max-width: 120px;
            object-fit: contain;
        }

        .nav-title {
            color: white;
            text-align: center;
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .nav-buttons {
            display: flex;
            gap: 5px;
            overflow-x: auto;
            padding: 5px;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }

        .nav-buttons::-webkit-scrollbar {
            display: none;
        }

        .nav-btn {
            flex: 0 0 auto;
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .nav-btn.active {
            background: white;
            color: #00A8E9;
            border-color: white;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            width: 100%;
        }

        .header {
            background: linear-gradient(135deg, #00A8E9 0%, #000E47 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
            min-height: 140px;
            flex-wrap: wrap;
        }

        .header-logo {
            max-height: 100%;
            height: 140px;
            max-width: 280px;
            object-fit: contain;
        }

        .header-content {
            flex: 1;
            max-width: 600px;
            min-width: 200px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            cursor: default;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.95;
        }

        .header-description {
            font-size: 0.95em;
            opacity: 0.85;
            margin-top: 15px;
            font-style: italic;
            line-height: 1.5;
        }

        .lightning-easter-egg {
            display: inline-block;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            animation: sparkle 2s infinite;
        }

        .lightning-easter-egg:hover {
            transform: scale(1.2) rotate(15deg);
            filter: brightness(1.5);
        }

        @keyframes sparkle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .florent-label {
            position: absolute;
            bottom: 40px;
            left: 30%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.95);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
            color: #495057;
            z-index: 8;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            pointer-events: none;
        }

        .person.electrocuted {
            animation: electrocute 0.5s ease-out;
        }

        @keyframes electrocute {
            0%, 100% { 
                filter: brightness(1);
                transform: translateX(-50%) rotate(0deg);
            }
            10%, 30%, 50%, 70%, 90% { 
                filter: brightness(5) contrast(2);
                transform: translateX(-50%) rotate(-5deg);
            }
            20%, 40%, 60%, 80% { 
                filter: brightness(5) contrast(2);
                transform: translateX(-50%) rotate(5deg);
            }
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
            padding: 30px;
            max-width: 100%;
        }

        .top-section {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 30px;
            max-width: 100%;
        }

        .left-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .control-group label {
            font-weight: 600;
            color: #333;
            font-size: 0.95em;
        }

        .control-group input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: linear-gradient(to right, #e74c3c, #f39c12, #2ecc71);
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }

        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #00A8E9;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .control-group input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #00A8E9;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .value-display {
            font-size: 1.2em;
            font-weight: bold;
            color: #00A8E9;
            text-align: center;
            padding: 10px;
            background: #f0f8ff;
            border-radius: 8px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            flex: 1;
            min-width: 80px;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00A8E9, #0088CC);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 168, 233, 0.4);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
            border: 2px solid #00A8E9;
        }

        .btn-secondary:hover {
            background: #00A8E9;
            color: white;
        }

        .preset-button {
            padding: 8px;
            background: #f0f0f0;
            border: 2px solid #00A8E9;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            color: #333;
            transition: all 0.3s;
            font-size: 0.85em;
        }

        .preset-button:hover {
            background: #00A8E9;
            color: white;
            transform: translateY(-2px);
        }

        .right-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .visualization-wrapper {
            background: #f9f9f9;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid #e0e0e0;
        }

        #visualization {
            position: relative;
            height: 600px;
            background: linear-gradient(to bottom, #e3f2fd 0%, #fff9c4 85%, #8d6e63 85%, #8d6e63 100%);
            overflow: hidden;
        }

        .scale-track {
            position: absolute;
            left: 0;
            top: 0;
            width: 50px;
            height: 100%;
            background: rgba(0,0,0,0.05);
            border-right: 1px solid #ccc;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }

        .scale-mark {
            padding: 0 5px;
            font-size: 0.7em;
            color: #666;
            text-align: right;
            font-weight: bold;
            height: 20px;
            display: flex;
            align-items: flex-end;
        }

        .falling-object {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            font-size: 3em;
            z-index: 5;
        }

        @keyframes fall {
            from {
                top: var(--start-height);
            }
            to {
                top: calc(100% - 80px);
            }
        }

        .reference {
            display: flex;
            align-items: center;
            gap: 10px;
            position: absolute;
            right: 80px;
            font-size: 0.85em;
            color: #666;
        }

        .reference-icon {
            font-size: 1.5em;
        }

        .ground {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 80px;
            background: linear-gradient(to bottom, #8d6e63, #6d4c41);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .person {
            font-size: 3em;
            animation: none;
        }

        .impact-effect {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 4em;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 10;
        }

        .impact-effect.show {
            opacity: 1;
            animation: impact-burst 0.6s ease-out;
        }

        @keyframes impact-burst {
            0% {
                transform: translateX(-50%) scale(0);
                opacity: 1;
            }
            100% {
                transform: translateX(-50%) scale(1.5);
                opacity: 0;
            }
        }

        .speech-bubble {
            position: absolute;
            bottom: 150px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border: 2px solid #333;
            border-radius: 12px;
            padding: 10px 15px;
            font-size: 0.85em;
            max-width: 150px;
            text-align: center;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 11;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid white;
        }

        .speech-bubble.show {
            opacity: 1;
        }

        .analysis-section {
            background: #f9f9f9;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #e0e0e0;
        }

        .analysis-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }

        .damage-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .damage-card {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #ddd;
            transition: all 0.3s;
            cursor: default;
        }

        .damage-card.active {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            border-color: #333;
        }

        .damage-card.slight {
            background: #c8e6c9;
            color: #2e7d32;
        }

        .damage-card.minor {
            background: #fff9c4;
            color: #f57f17;
        }

        .damage-card.major {
            background: #ffccbc;
            color: #d84315;
        }

        .damage-card.fatality {
            background: #ffcdd2;
            color: #c62828;
        }

        .damage-card.active.slight {
            border-color: #2e7d32;
        }

        .damage-card.active.minor {
            border-color: #f57f17;
        }

        .damage-card.active.major {
            border-color: #d84315;
        }

        .damage-card.active.fatality {
            border-color: #c62828;
        }

        .card-label {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .card-description {
            font-size: 0.8em;
            line-height: 1.3;
        }

        .equivalence-display-large {
            text-align: center;
            padding: 20px;
            border: 2px solid #00A8E9;
            border-radius: 8px;
            background: #f0f8ff;
        }

        .equivalence-icon-large {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .equivalence-text-large {
            font-weight: bold;
            color: #333;
            line-height: 1.4;
        }

        .timeline-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            position: relative;
        }

        .timeline-container::-webkit-scrollbar {
            height: 6px;
        }

        .timeline-container::-webkit-scrollbar-track {
            background: #f0f0f0;
            border-radius: 10px;
        }

        .timeline-container::-webkit-scrollbar-thumb {
            background: #00A8E9;
            border-radius: 10px;
        }

        .timeline-track {
            display: flex;
            gap: 15px;
            padding: 20px;
            min-width: min-content;
            position: relative;
        }

        .timeline-item {
            flex: 0 0 auto;
            width: 120px;
            padding: 15px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .timeline-item:hover {
            border-color: #00A8E9;
            transform: translateY(-2px);
        }

        .timeline-item.active {
            background: #00A8E9;
            color: white;
            border-color: #00A8E9;
        }

        .timeline-value {
            font-size: 0.75em;
            margin-bottom: 5px;
            opacity: 0.7;
        }

        .timeline-description {
            font-weight: bold;
            font-size: 0.85em;
        }

        .timeline-marker {
            position: absolute;
            bottom: 0;
            height: 3px;
            background: #00A8E9;
            width: 80px;
            left: 20px;
            border-radius: 2px;
            transition: left 0.3s ease;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .mobile-nav {
                display: block;
                margin-top: 0;
                padding-top: 60px;
            }

            body {
                padding: 0;
                padding-top: 60px;
            }

            .container {
                border-radius: 0;
                margin-top: -60px;
                margin-bottom: 0;
            }

            .header {
                padding: 20px;
                min-height: auto;
                gap: 15px;
                flex-direction: column;
            }

            .header-logo {
                height: 100px;
                max-width: 200px;
            }

            .header h1 {
                font-size: 1.5em;
            }

            .header p {
                font-size: 0.9em;
            }

            .main-grid {
                padding: 20px;
                gap: 20px;
            }

            .top-section {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            #visualization {
                height: 350px;
            }

            .analysis-section {
                padding: 15px;
            }

            .damage-cards {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }

            .damage-card {
                padding: 10px;
                font-size: 0.85em;
            }

            .timeline-track {
                padding: 15px;
                gap: 10px;
            }

            .timeline-item {
                width: 100px;
                padding: 10px;
                font-size: 0.75em;
            }

            .falling-object {
                font-size: 2em;
            }

            .person {
                font-size: 2em;
            }

            .reference {
                font-size: 0.7em;
                right: 60px;
            }

            .scale-track {
                width: 40px;
            }

            .scale-mark {
                font-size: 0.6em;
            }

            .control-group label {
                font-size: 0.9em;
            }

            .value-display {
                font-size: 1em;
            }

            .analysis-title {
                font-size: 1em;
            }

            .equivalence-icon-large {
                font-size: 2em;
            }

            .equivalence-text-large {
                font-size: 0.9em;
            }

            .btn {
                padding: 10px 15px;
                font-size: 0.85em;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 15px;
            }

            .header-logo {
                height: 80px;
                max-width: 150px;
            }

            .header h1 {
                font-size: 1.2em;
            }

            .main-grid {
                padding: 15px;
                gap: 15px;
            }

            #visualization {
                height: 280px;
            }

            .damage-cards {
                grid-template-columns: 1fr;
            }

            .timeline-item {
                width: 90px;
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Navigation -->
    <div class="mobile-nav" id="mobileNav">
        <div class="header-logos-mobile">
            <img src="./logo_cou.png" alt="Logo" class="header-logo-mobile" onerror="this.style.display='none'">
            <img src="./logo_drop.png" alt="Logo" class="header-logo-mobile" onerror="this.style.display='none'">
        </div>
        <div class="nav-title">Falling Object Impact</div>
        <div class="nav-buttons" id="navButtons"></div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Header -->
        <div class="header">
            <img src="./logo_cou.png" alt="Logo" class="header-logo" onerror="this.style.display='none'">
            <div class="header-content">
                <h1>‚ö†Ô∏è Falling Object Impact Simulator <span class="lightning-easter-egg" onclick="triggerLightning()">‚ö°</span></h1>
                <p>Understand the dangers of objects at height</p>
                <p class="header-description">This tool is made for educational purposes. Try to see the effects of usual objects falling on someone from different heights!</p>
            </div>
            <img src="./logo_drop.png" alt="Logo" class="header-logo" onerror="this.style.display='none'">
        </div>

        <!-- Main Content -->
        <div class="main-grid">
            <!-- Top Section: Controls and Visualization -->
            <div class="top-section">
                <!-- Left Column: Controls -->
                <div class="left-column">
                    <div class="controls">
                        <!-- Height Control -->
                        <div class="control-group">
                            <label for="heightInput">Height (m)</label>
                            <input type="range" id="heightInput" min="1" max="100" value="10" step="0.5">
                            <div class="value-display" id="heightValue">10.0 m</div>
                        </div>

                        <!-- Object Weight Control -->
                        <div class="control-group">
                            <label for="weightInput">Object Weight (kg)</label>
                            <input type="range" id="weightInput" min="0.1" max="50" value="5" step="0.1">
                            <div class="value-display" id="weightValue">5.0 kg</div>
                        </div>

                        <!-- Energy Display -->
                        <div class="control-group">
                            <label>Energy</label>
                            <div class="value-display" id="energyDisplay">Energy: 490.5 J</div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="button-group">
                            <button class="btn btn-primary" onclick="simulateFall()">Drop Object</button>
                            <button class="btn btn-secondary" onclick="resetSimulation()">Reset</button>
                        </div>

                        <!-- Presets -->
                        <div class="control-group">
                            <label>Quick Presets</label>
                            <div id="presetsContainer" style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;"></div>
                        </div>
                    </div>

                    <!-- Impact Analysis Section -->
                    <div class="analysis-section">
                        <div class="analysis-title">Impact Analysis</div>
                        <div class="damage-cards">
                            <div class="damage-card slight" id="slight">
                                <div class="card-label">Slight</div>
                                <div class="card-description">Minor injuries</div>
                            </div>
                            <div class="damage-card minor" id="minor">
                                <div class="card-label">Minor</div>
                                <div class="card-description">Moderate injuries</div>
                            </div>
                            <div class="damage-card major" id="major">
                                <div class="card-label">Major</div>
                                <div class="card-description">Severe injuries</div>
                            </div>
                            <div class="damage-card fatality" id="fatality">
                                <div class="card-label">Fatality</div>
                                <div class="card-description">Fatal outcome</div>
                            </div>
                        </div>
                        <div class="equivalence-display-large" id="equivalenceDisplayLarge"></div>
                    </div>
                </div>

                <!-- Right Column: Visualization -->
                <div class="right-column">
                    <div class="visualization-wrapper">
                        <div id="visualization">
                            <div class="scale-track" id="heightScale"></div>
                            <div class="falling-object" id="fallingObject">üì¶</div>
                            <div class="ground">
                                <div class="person" id="person">üßç</div>
                            </div>
                            <div class="impact-effect" id="impactEffect">üí•</div>
                            <div class="speech-bubble" id="speechBubble"></div>
                            <div class="reference" id="ref-car">
                                <span class="reference-icon">üöó</span>
                                <span>Car (1.5m)</span>
                            </div>
                            <div class="reference" id="ref-truck">
                                <span class="reference-icon">üöö</span>
                                <span>Truck (3.5m)</span>
                            </div>
                            <div class="reference" id="ref-building">
                                <span class="reference-icon">üè¢</span>
                                <span>Building (10m)</span>
                            </div>
                            <div class="reference" id="ref-crane">
                                <span class="reference-icon">üèóÔ∏è</span>
                                <span>Crane (30m)</span>
                            </div>
                            <div class="reference" id="ref-arc">
                                <span class="reference-icon">‚úàÔ∏è</span>
                                <span>Plane (50m)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Impact for Scale Section -->
            <div class="analysis-section">
                <div class="analysis-title">Impact for Scale</div>
                <div class="timeline-container" id="timelineContainer">
                    <div class="timeline-track" id="timelineTrack"></div>
                    <div class="timeline-marker" id="timelineMarker"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Constants
        const g = 9.81;
        const THRESHOLDS = {
            slight: 100,
            minor: 500,
            major: 2000
        };

        const EQUIVALENCES = [
            { maxEnergy: 50, icon: 'ü™∂', text: 'Like a feather touch' },
            { maxEnergy: 100, icon: 'üìö', text: 'Like a textbook to the head' },
            { maxEnergy: 300, icon: 'üéæ', text: 'Like a tennis serve at full force' },
            { maxEnergy: 700, icon: 'üèÄ', text: 'Like being hit by a thrown basketball' },
            { maxEnergy: 1500, icon: 'ü•ä', text: 'Like a punch from a boxer' },
            { maxEnergy: 3000, icon: 'üöó', text: 'Like being hit by a car at 5 mph' },
            { maxEnergy: 7000, icon: 'üöóüí®', text: 'Like being hit by a car at 10 mph' },
            { maxEnergy: Infinity, icon: 'üí•', text: 'Extreme danger - beyond safe thresholds' }
        ];

        const SPEECH_BUBBLES = {
            slight: ['Ouch! üò£', 'That hurt!', 'Ow!'],
            minor: ['This is bad... üòµ', 'Can\'t move...', 'Help me!'],
            major: ['Emergency!', 'Call an ambulance!', 'Help! üÜò'],
            fatality: ['...', '‚ò†Ô∏è', '...']
        };

        // DOM elements
        const heightInput = document.getElementById('heightInput');
        const weightInput = document.getElementById('weightInput');
        const heightValue = document.getElementById('heightValue');
        const energyDisplay = document.getElementById('energyDisplay');
        const fallingObject = document.getElementById('fallingObject');
        const impactEffect = document.getElementById('impactEffect');
        const speechBubble = document.getElementById('speechBubble');
        const person = document.getElementById('person');
        const heightScale = document.getElementById('heightScale');
        const timelineTrack = document.getElementById('timelineTrack');
        const timelineMarker = document.getElementById('timelineMarker');
        const timelineContainer = document.getElementById('timelineContainer');
        const navButtons = document.getElementById('navButtons');

        let currentHeight = 10;
        let currentWeight = 5;
        let isMobile = window.innerWidth <= 768;

        // Lightning Easter Egg
        function triggerLightning() {
            person.classList.remove('electrocuted');
            void person.offsetWidth;
            person.classList.add('electrocuted');
            person.textContent = '‚ö°';
            setTimeout(() => {
                person.textContent = 'üßç';
            }, 500);
        }

        // Reset simulation
        function resetSimulation() {
            fallingObject.style.animation = 'none';
            impactEffect.classList.remove('show');
            speechBubble.classList.remove('show');
            person.textContent = 'üßç';
        }

        // Create presets
        function createPresets() {
            const presets = [
                { name: 'Pen', weight: 0.01, height: 2 },
                { name: 'Ball', weight: 0.5, height: 5 },
                { name: 'Hammer', weight: 2, height: 10 },
                { name: 'Safe', weight: 50, height: 5 },
                { name: 'Wrench', weight: 3, height: 20 },
                { name: 'Brick', weight: 2.5, height: 15 }
            ];

            const container = document.getElementById('presetsContainer');
            presets.forEach(preset => {
                const button = document.createElement('button');
                button.className = 'preset-button';
                button.textContent = preset.name;
                button.onclick = () => {
                    weightInput.value = preset.weight;
                    heightInput.value = preset.height;
                    updateDisplay();
                };
                container.appendChild(button);
            });
        }

        // Create timeline
        function createTimeline() {
            const energyValues = [0, 100, 500, 1000, 2000, 5000, 10000];
            timelineTrack.innerHTML = '';

            energyValues.forEach(energy => {
                const item = document.createElement('div');
                item.className = 'timeline-item';
                item.innerHTML = `
                    <div class="timeline-value">${energy}J</div>
                    <div class="timeline-description">${getEquivalence(energy).icon}</div>
                `;
                item.onclick = () => {
                    selectTimelineItem(item, energy);
                };
                timelineTrack.appendChild(item);
            });
        }

        // Select timeline item
        function selectTimelineItem(element, energy) {
            document.querySelectorAll('.timeline-item').forEach(item => {
                item.classList.remove('active');
            });
            element.classList.add('active');

            const items = document.querySelectorAll('.timeline-item');
            const currentIndex = Array.from(items).indexOf(element);
            
            if (currentIndex !== -1) {
                const itemRect = items[currentIndex].getBoundingClientRect();
                const trackRect = timelineTrack.getBoundingClientRect();
                const markerLeft = itemRect.left - trackRect.left + (itemRect.width / 2) - 40;
                timelineMarker.style.left = markerLeft + 'px';
                
                items[currentIndex].scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
            }
        }

        // Update timeline
        function updateTimeline(energy) {
            const items = document.querySelectorAll('.timeline-item');
            let closestItem = items[0];
            let minDiff = Math.abs(100 - energy);

            items.forEach((item, index) => {
                const itemValue = [0, 100, 500, 1000, 2000, 5000, 10000][index];
                const diff = Math.abs(itemValue - energy);
                if (diff < minDiff) {
                    minDiff = diff;
                    closestItem = item;
                }
            });

            const currentIndex = Array.from(items).indexOf(closestItem);
            if (currentIndex !== -1) {
                const itemRect = items[currentIndex].getBoundingClientRect();
                const trackRect = timelineTrack.getBoundingClientRect();
                const markerLeft = itemRect.left - trackRect.left + (itemRect.width / 2) - 40;
                timelineMarker.style.left = markerLeft + 'px';
                
                items[currentIndex].scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
            }
        }

        // Find appropriate equivalence
        function getEquivalence(energy) {
            for (let equiv of EQUIVALENCES) {
                if (energy <= equiv.maxEnergy) {
                    return equiv;
                }
            }
            return EQUIVALENCES[EQUIVALENCES.length - 1];
        }

        // Calculate dynamic max height for visualization scale
        function getDynamicMaxHeight(currentHeight) {
            const withMargin = currentHeight * 1.3;
            const roundedUp = Math.ceil(withMargin / 10) * 10;
            return Math.max(10, roundedUp);
        }

        // Update height scale
        function updateHeightScale() {
            heightScale.innerHTML = '';
            const dynamicMaxHeight = getDynamicMaxHeight(currentHeight);
            
            const marks = [];
            const interval = dynamicMaxHeight <= 20 ? 5 : 10;
            for (let i = 0; i <= dynamicMaxHeight; i += interval) {
                marks.push(i);
            }
            
            marks.forEach(mark => {
                if (mark <= dynamicMaxHeight) {
                    const div = document.createElement('div');
                    div.className = 'scale-mark';
                    div.textContent = mark + 'm';
                    div.style.top = (100 - (mark / dynamicMaxHeight * 100)) + '%';
                    heightScale.appendChild(div);
                }
            });

            const visualizationElement = document.getElementById('visualization');
            const visualizationHeight = visualizationElement.offsetHeight;
            const groundHeight = 80;
            const usableHeight = visualizationHeight - groundHeight;
            
            const references = [
                { id: 'ref-car', height: 1.5 },
                { id: 'ref-truck', height: 3.5 },
                { id: 'ref-building', height: 10 },
                { id: 'ref-crane', height: 30 },
                { id: 'ref-arc', height: 50 }
            ];
            
            references.forEach(ref => {
                const element = document.getElementById(ref.id);
                if (element) {
                    if (ref.height <= dynamicMaxHeight) {
                        const positionFromBottom = groundHeight + (ref.height / dynamicMaxHeight) * usableHeight;
                        element.style.position = 'absolute';
                        element.style.bottom = positionFromBottom + 'px';
                        element.style.right = '60px';
                        element.style.display = 'flex';
                    } else {
                        element.style.display = 'none';
                    }
                }
            });
        }

        // Calculate energy
        function calculateEnergy(mass, height) {
            return mass * g * height;
        }

        // Determine damage level
        function getDamageLevel(energy) {
            if (energy < THRESHOLDS.slight) return 'slight';
            if (energy < THRESHOLDS.minor) return 'minor';
            if (energy < THRESHOLDS.major) return 'major';
            return 'fatality';
        }

        // Update display
        function updateDisplay() {
            currentWeight = parseFloat(weightInput.value);
            currentHeight = parseFloat(heightInput.value);
            
            heightValue.textContent = currentHeight.toFixed(1) + ' m';
            weightValue.textContent = currentWeight.toFixed(1) + ' kg';
            
            const energy = calculateEnergy(currentWeight, currentHeight);
            energyDisplay.textContent = `Energy: ${energy.toFixed(1)} J`;
            
            const equiv = getEquivalence(energy);
            document.getElementById('equivalenceDisplayLarge').innerHTML = `
                <div class="equivalence-icon-large">${equiv.icon}</div>
                <div class="equivalence-text-large">${equiv.text}</div>
            `;
            
            updateTimeline(energy);
            
            const dynamicMaxHeight = getDynamicMaxHeight(currentHeight);
            const visualizationElement = document.getElementById('visualization');
            const visualizationHeight = visualizationElement.offsetHeight;
            const groundHeight = 80;
            const usableHeight = visualizationHeight - groundHeight;
            
            const topPosition = ((dynamicMaxHeight - currentHeight) / dynamicMaxHeight) * usableHeight;
            fallingObject.style.top = topPosition + 'px';
            
            const damageLevel = getDamageLevel(energy);
            ['slight', 'minor', 'major', 'fatality'].forEach(level => {
                const card = document.getElementById(level);
                if (level === damageLevel) {
                    card.classList.add('active');
                } else {
                    card.classList.remove('active');
                }
            });
            
            updateHeightScale();
        }

        // Events
        heightInput.addEventListener('input', () => {
            currentHeight = parseFloat(heightInput.value);
            updateDisplay();
        });

        weightInput.addEventListener('input', () => {
            currentWeight = parseFloat(weightInput.value);
            updateDisplay();
        });

        // Simulate fall
        function simulateFall() {
            fallingObject.style.animation = 'none';
            impactEffect.classList.remove('show');
            speechBubble.classList.remove('show');
            person.textContent = 'üßç';
            
            void fallingObject.offsetWidth;
            
            setTimeout(() => {
                const dynamicMaxHeight = getDynamicMaxHeight(currentHeight);
                const visualizationElement = document.getElementById('visualization');
                const visualizationHeight = visualizationElement.offsetHeight;
                const groundHeight = 80;
                const usableHeight = visualizationHeight - groundHeight;
                const startPosition = ((dynamicMaxHeight - currentHeight) / dynamicMaxHeight) * usableHeight;
                
                const fallTime = Math.sqrt(2 * currentHeight / g);
                
                fallingObject.style.setProperty('--start-height', startPosition + 'px');
                fallingObject.style.animation = `fall ${fallTime}s linear`;
                
                setTimeout(() => {
                    impactEffect.classList.add('show');
                    
                    const damageLevel = getDamageLevel(calculateEnergy(currentWeight, currentHeight));
                    const messages = SPEECH_BUBBLES[damageLevel];
                    const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                    speechBubble.textContent = randomMessage;
                    speechBubble.classList.add('show');
                    
                    switch(damageLevel) {
                        case 'slight':
                            person.textContent = 'ü§ï';
                            break;
                        case 'minor':
                            person.textContent = 'üòµ';
                            break;
                        case 'major':
                            person.textContent = 'üöë';
                            break;
                        case 'fatality':
                            person.textContent = 'üíÄ';
                            break;
                    }
                    
                    setTimeout(() => {
                        impactEffect.classList.remove('show');
                        speechBubble.classList.remove('show');
                    }, 2500);
                }, fallTime * 1000);
            }, 100);
        }

        // Swipe handling for timeline
        let touchStartX = 0;
        let touchEndX = 0;

        timelineContainer.addEventListener('touchstart', (e) => {
            touchStartX = e.changedTouches[0].screenX;
        }, false);

        timelineContainer.addEventListener('touchend', (e) => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        }, false);

        function handleSwipe() {
            const swipeThreshold = 50;
            const diff = touchStartX - touchEndX;

            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0) {
                    timelineContainer.scrollLeft += 150;
                } else {
                    timelineContainer.scrollLeft -= 150;
                }
            }
        }

        // Window resize
        window.addEventListener('resize', () => {
            isMobile = window.innerWidth <= 768;
            updateHeightScale();
            updateDisplay();
        });

        // Initialization
        createPresets();
        createTimeline();
        updateHeightScale();
        updateDisplay();

        // Add weight value display
        const weightValue = document.createElement('div');
        weightValue.id = 'weightValue';
        weightValue.className = 'value-display';
        weightValue.textContent = '5.0 kg';
    </script>
</body>
</html>